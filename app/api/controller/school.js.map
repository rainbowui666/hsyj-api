{
    "version": 3,
    "sources": [
        "../../../src/api/controller/school.js"
    ],
    "names": [
        "Base",
        "require",
        "fs",
        "module",
        "exports",
        "indexAction",
        "page",
        "get",
        "size",
        "schoolname",
        "areaid",
        "model",
        "_pk",
        "data",
        "think",
        "isEmpty",
        "countSelect",
        "where",
        "schoolName",
        "arrdata",
        "item",
        "pics",
        "getPicsbyid",
        "schoolID",
        "shstate",
        "getstate",
        "push",
        "success",
        "getSchoolListAction",
        "userinfo",
        "cache",
        "schoolid",
        "getAreaAction",
        "select",
        "detailAction",
        "id",
        "find",
        "scenery",
        "getScenerybyid",
        "discussList",
        "getDiscussById",
        "deleteAction",
        "update",
        "addEditAction",
        "post",
        "province",
        "city",
        "address",
        "schooldesc",
        "longitude",
        "latitude",
        "soundurl",
        "videourl",
        "parentid",
        "param",
        "createbyuserid",
        "sysUserID",
        "insertid",
        "add",
        "json",
        "targetid",
        "delete"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/school.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst fs = require('fs');\n\nmodule.exports = class extends Base {\n    async indexAction() {\n        const page = this.get('page') || 1;\n        const size = this.get('size') || 10;\n        const schoolname = this.get('schoolname') || '';\n        const areaid = this.get('areaid') || '';\n        \n        const model = this.model('school');\n        model._pk = 'schoolID';\n        var data;\n        if (think.isEmpty(schoolname) && think.isEmpty(areaid)) {\n            data = await model.page(page, size).countSelect();\n        } else if (!think.isEmpty(schoolname)) {\n            data = await model.where({schoolName: ['like', `%${schoolname}%`]}).page(page, size).countSelect();\n        } else {\n            data = await model.where({areaid: areaid}).page(page, size).countSelect();\n        }\n        \n        const arrdata = [];\n        for (const item of data.data) {\n            item.pics = await this.model('school').getPicsbyid(item.schoolID);\n            item.shstate = await this.model('school').getstate(item.schoolID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n        return this.success(data)\n    }\n\n    async getSchoolListAction() {\n        const page = this.get('page') || 1;\n        const size = this.get('size') || 10;\n        const schoolname = this.get('schoolname') || '';\n        const areaid = this.get('areaid') || '';\n        let userinfo = await this.cache('userinfo');\n        \n        const model = this.model('school');\n        model._pk = 'schoolID';\n        var data;\n        if (think.isEmpty(schoolname) && think.isEmpty(areaid)) {\n            data = await model.where({schoolID: userinfo[0].schoolid}).page(page, size).countSelect();\n        } else if (!think.isEmpty(schoolname)) {\n            data = await model.where({schoolName: ['like', `%${schoolname}%`],schoolID: userinfo[0].schoolid}).page(page, size).countSelect();\n        } else {\n            data = await model.where({areaid: areaid, schoolID: userinfo[0].schoolid}).page(page, size).countSelect();\n        }\n        \n        const arrdata = [];\n        for (const item of data.data) {\n            item.pics = await this.model('school').getPicsbyid(item.schoolID);\n            item.shstate = await this.model('school').getstate(item.schoolID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n        return this.success(data)\n    }\n\n    async getAreaAction() {\n        const data = await this.model('area').select();\n        return this.success(data);\n    }\n    \n    async detailAction() {\n        const id = this.get('id');\n        const model = this.model('school');\n        // model._pk = 'schoolID';\n\n        const data = await model.where({schoolID: id}).find();\n\n        const arrdata = [];\n        if (!think.isEmpty(data)) {\n        // for (const item of data.data) {\n            data.scenery = await this.model('school').getScenerybyid(data.schoolID);\n            data.discussList = await this.model('discuss').getDiscussById(id,2);\n        //     // item.shstate = await this.model('school').getstate(item.schoolID);\n        //     arrdata.push(item);\n        // }\n        // data.data = arrdata;\n        }\n        return this.success(data)\n    }\n\n    async deleteAction() {\n        const id = this.get('id');\n        const data = {\n            shstate: 1\n        }\n        await this.model('school').where({schoolID:id}).update(data);\n        return this.success('学校删除成功')\n    }\n    \n    async addEditAction() {\n        const schoolname = this.post('schoolname');\n        const province = this.post('province') || '';\n        const city = this.post('city') || '';\n        const address = this.post('address') || '';\n        const schooldesc= this.post('schooldesc');\n        const longitude = this.post('longitude');\n        const latitude = this.post('latitude');\n        const soundurl = this.post('soundurl');\n        const videourl = this.post('videourl');\n        const areaid = this.post('areaid');\n        const parentid = this.post('parentid') || 0;\n        const id = this.get('id');\n        let userinfo = await this.cache('userinfo');\n\n        let param = {\n            schoolName: schoolname,\n            province: province,\n            city: city,\n            address: address,\n            schooldesc: schooldesc,\n            longitude: longitude,\n            latitude: latitude,\n            soundurl,\n            videourl,areaid,parentid,\n            createbyuserid: userinfo[0].sysUserID\n        }; \n        if (think.isEmpty(id)) {\n            let model = this.model('school');\n            const insertid = await model.add(param);\n            \n            // 上传学校图片\n            if (insertid) {\n                // const sourceaddress = this.post('sourceaddress');\n                // const insertid2 = await this.model('source').add({\n                //     sourceType:0,\n                //     sourceAddress: sourceaddress,\n                //     targetid: insertid\n                // });\n                return this.json({\n                        insertid:insertid\n                    });\n            }\n        } else {\n            // 1 删除source, 2修改\n            await this.model('source').where({targetid:id}).delete();\n            await this.model('school').where({schoolID:id}).update(param);\n            return this.success('学校修改成功')\n        }\n        \n    }\n}"
    ]
}