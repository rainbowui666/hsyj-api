{
    "version": 3,
    "sources": [
        "../../../src/api/controller/group.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "addEditAction",
        "id",
        "post",
        "groupname",
        "studentid",
        "param",
        "activityid",
        "groupName",
        "insertid",
        "model",
        "add",
        "success",
        "readyScanAction",
        "get",
        "cache",
        "joinGroupAction",
        "groupid",
        "para",
        "scanstudnetid",
        "think",
        "isEmpty",
        "actData",
        "field",
        "where",
        "activityID",
        "find",
        "groupnum",
        "parseInt",
        "groupNum",
        "groupcount",
        "count",
        "fail",
        "console",
        "log",
        "display",
        "showQrAction",
        "url",
        "qrService",
        "service",
        "type",
        "body",
        "getQrByUrl"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/group.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n    async addEditAction() {\n        const id = this.post('id');\n        const groupname = this.post('groupname');\n        const studentid = this.post('studentid')\n\n        let param = {\n            activityid:id,\n            groupName:groupname,\n            studentid: studentid\n        }\n\n        const insertid = await this.model('group').add(param);\n        return this.success('添加成功')\n    }\n\n    async readyScanAction() {\n        const studentid = this.get('studentid');\n        this.cache('scan'+studentid, studentid);\n        return this.success({'scan': studentid})\n    }\n\n    async joinGroupAction() {\n        const groupid = this.get('groupid');\n        const studentid = this.get('studentid');\n        const activityid = this.get('activityid');\n        let para = {\n            groupid,studentid,activityid\n        }\n\n        const scanstudnetid = await this.cache('scan'+studentid);\n        if (!think.isEmpty(scanstudnetid)) {  \n            this.cache('scan'+studentid, null);\n                  \n            const actData = await this.model('activity').field(['activityID','groupNum']).where({activityID: activityid}).find();\n            let groupnum = 0\n            if (!think.isEmpty(actData)) {\n                groupnum = parseInt(actData.groupNum);\n            }\n\n            const groupcount = await this.model('student_group').where({activityID: activityid}).count();\n            if (groupcount >= groupnum) {\n                // console.log('fail group----')\n                return this.fail('加入失败, 超过团体活动最大限制人数')\n            } else {\n                console.log('joingroup------',groupid,studentid,activityid)\n                // console.log('success group----')\n                let insertid = await this.model('student_group').add(para);\n                return this.success('扫码加入成功')\n            }\n        } else {\n            return this.display('pages/groupSuccess')\n        }\n    }\n\n    async showQrAction() {\n        const url = this.get('url');\n        const studentid = this.get('studentid');\n        const activityid = this.get('activityid');\n\n        \n        console.log('showqr', url, studentid, activityid)\n        \n            \n            const qrService = this.service('qr', 'api');\n            this.type = 'image/svg+xml';\n            this.body = qrService.getQrByUrl(url+'&studentid='+studentid+'&activityid='+activityid);\n        \n    }\n}"
    ]
}