{
    "version": 3,
    "sources": [
        "../../../src/api/controller/upload.js"
    ],
    "names": [
        "Base",
        "require",
        "fs",
        "module",
        "exports",
        "indexAction",
        "display",
        "uploadFileAction",
        "self",
        "fileInfo",
        "file",
        "think",
        "isEmpty",
        "fail",
        "that",
        "extension",
        "name",
        "indexOf",
        "exname",
        "uuid",
        "filename",
        "config",
        "is",
        "createReadStream",
        "path",
        "os",
        "createWriteStream",
        "pipe",
        "json",
        "error",
        "errmsg",
        "success",
        "wxUploadAction",
        "sourcetype",
        "post",
        "insertid",
        "img",
        "_name",
        "tempName",
        "split",
        "timestamp",
        "_",
        "uniqueId",
        "length",
        "thumbUrl",
        "thumbSmallUrl",
        "renameSync",
        "images",
        "resize",
        "save",
        "console",
        "log",
        "imgObj",
        "model",
        "add",
        "sourceType",
        "sourceAddress",
        "targetid"
    ],
    "mappings": ";;AAAA,MAAMA,OAAOC,QAAQ,WAAR,CAAb;AACA,MAAMC,KAAKD,QAAQ,IAAR,CAAX;;AAEAE,OAAOC,OAAP,GAAiB,cAAcJ,IAAd,CAAmB;AAChCK,kBAAa;AACT,aAAKC,OAAL;AACH;;AAEDC,uBAAmB;AACf,YAAIC,OAAO,IAAX;AACA,YAAIC,WAAW,KAAKC,IAAL,CAAU,QAAV,CAAf;;AAEA,YAAIC,MAAMC,OAAN,CAAcH,QAAd,CAAJ,EAA6B;AACzB,mBAAO,KAAKI,IAAL,CAAU,MAAV,CAAP;AACD;AACD,cAAMC,OAAO,IAAb;AACA,YAAIC,YAAYN,SAASO,IAAzB;AACA,YAAID,UAAUE,OAAV,CAAkB,MAAlB,KAA6B,CAAC,CAA9B,IAAmCF,UAAUE,OAAV,CAAkB,MAAlB,KAA6B,CAAC,CAArE,EAAwE;AACtEF,wBAAY,MAAZ;AACD,SAFD,MAEO,IAAIA,UAAUE,OAAV,CAAkB,MAAlB,KAA6B,CAAC,CAAlC,EAAqC;AAC1CF,wBAAY,MAAZ;AACD;AACH;AACA,YAAIG,SAASP,MAAMQ,IAAN,CAAW,EAAX,IAAiBJ,SAA9B;AACA,cAAMK,WAAW,KAAKC,MAAL,CAAY,YAAZ,IAA2BH,MAA5C;;AAEE,cAAMI,KAAKpB,GAAGqB,gBAAH,CAAoBd,SAASe,IAA7B,CAAX;AACA,cAAMC,KAAKvB,GAAGwB,iBAAH,CAAqBN,QAArB,CAAX;AACAE,WAAGK,IAAH,CAAQF,EAAR;;AAEF,YAAGhB,QAAH,EAAa;AACTD,iBAAKoB,IAAL,CAAU;AACNC,uBAAO,CADD;AAENC,wBAAQ,IAFF;AAGNV,0BAAUF,MAHJ;AAINa,yBAAS,IAJH,CAIQ;AAJR,aAAV;AAMH,SAPD,MAOM;AACFvB,iBAAKqB,KAAL;AACH;AACJ;;AAEKG,kBAAN,GAAuB;AAAA;;AAAA;AACrB,kBAAMC,aAAa,MAAKC,IAAL,CAAU,YAAV,CAAnB;AACA,kBAAMC,WAAW,MAAKD,IAAL,CAAU,UAAV,CAAjB;;AAEA,kBAAME,MAAM,MAAK1B,IAAL,CAAU,MAAV,CAAZ;AACA,kBAAM2B,QAAQD,IAAIpB,IAAlB;;AAEA,kBAAMsB,WAAWD,MAAME,KAAN,CAAY,GAAZ,CAAjB;AACA,kBAAMC,YAAYC,EAAEC,QAAF,CAAW,WAAX,CAAlB;AACA,kBAAM1B,OAAOwB,YAAY,GAAZ,GAAkBL,QAAlB,GAA6B,GAA7B,GAAmCG,SAASA,SAASK,MAAT,GAAkB,CAA3B,CAAhD;AACA,kBAAMC,WAAW,MAAKvB,MAAL,CAAY,YAAZ,IAA4B,GAA5B,GAAkCL,IAAnD;AACA,kBAAM6B,gBAAgB,MAAKxB,MAAL,CAAY,YAAZ,IAA4B,SAA5B,GAAwCL,IAA9D;;AAEAd,eAAG4C,UAAH,CAAcV,IAAIZ,IAAlB,EAAwBoB,QAAxB;AACAG,mBAAOH,WAAW,EAAlB,EAAsBI,MAAtB,CAA6B,EAA7B,EAAiCC,IAAjC,CAAsCJ,aAAtC;AACAK,oBAAQC,GAAR,CAAY,WAAZ,EAAyBP,QAAzB,EAAmCC,aAAnC,EAAkD7B,IAAlD;AACA,kBAAMoC,SAAS,MAAM,MAAKC,KAAL,CAAW,QAAX,EAAqBC,GAArB,CAAyB,EAAEC,YAAYtB,UAAd,EAA0BuB,eAAe,WAAWxC,IAApD,EAAyDyC,UAAUtB,QAAnE,EAAzB,CAArB;AACA,mBAAO,MAAKP,IAAL,CAAUwB,MAAV,CAAP;AAjBqB;AAkBtB;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvEgC,CAApC",
    "file": "../../../src/api/controller/upload.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst fs = require('fs');\n\nmodule.exports = class extends Base {\n    indexAction(){\n        this.display();\n    }\n\n    uploadFileAction() {\n        var self = this;\n        var fileInfo = this.file('qqfile');\n\n        if (think.isEmpty(fileInfo)) {\n            return this.fail('保存失败');\n          }\n          const that = this;\n          let extension = fileInfo.name;\n          if (extension.indexOf('.jpg') != -1 || extension.indexOf('.jpg') != -1) {\n            extension = '.jpg'\n          } else if (extension.indexOf('.png') != -1) {\n            extension = '.png'\n          }\n        //   const filename = '/static/upload/' + think.uuid(16) + extension;\n        let exname = think.uuid(16) + extension;\n        const filename = this.config('image.user')+ exname;\n      \n          const is = fs.createReadStream(fileInfo.path);\n          const os = fs.createWriteStream(filename);\n          is.pipe(os);\n\n        if(fileInfo) {\n            self.json({\n                error: 0,\n                errmsg: 'ok',\n                filename: exname,\n                success: true //只有success返回true才认为上传成功\n            });\n        }else {\n            self.error();\n        }\n    }\n\n    async wxUploadAction() {\n      const sourcetype = this.post('sourcetype');\n      const insertid = this.post('insertid');\n\n      const img = this.file('file');\n      const _name = img.name;\n\n      const tempName = _name.split('.');\n      const timestamp = _.uniqueId('shculture');\n      const name = timestamp + '-' + insertid + '.' + tempName[tempName.length - 1];\n      const thumbUrl = this.config('image.user') + '/' + name;\n      const thumbSmallUrl = this.config('image.user') + '/small/' + name;\n\n      fs.renameSync(img.path, thumbUrl);\n      images(thumbUrl + '').resize(96).save(thumbSmallUrl);\n      console.log('wxupdload', thumbUrl, thumbSmallUrl, name)\n      const imgObj = await this.model('source').add({ sourceType: sourcetype, sourceAddress: 'small/' + name,targetid: insertid });\n      return this.json(imgObj);\n    }\n    // async upload2Action() {\n    //     const circleId = this.post('circleId');\n    //     const img = this.file('file');\n    //     const _name = img.name;\n    //     const tempName = _name.split('.');\n    //     const timestamp = _.uniqueId('circle');\n    //     const name = timestamp + '-' + circleId + '.' + tempName[tempName.length - 1];\n    //     const thumbUrl = this.config('image.circle') + '/' + name;\n    //     const thumbSmallUrl = this.config('image.circle') + '/small/' + name;\n    //     fs.renameSync(img.path, thumbUrl);\n    //     images(thumbUrl + '').resize(96).save(thumbSmallUrl);\n    //     const imgObj = await this.model('circle_img').add({ circle_id: circleId, url: 'https://static.huanjiaohu.com/image/circle/small/' + name });\n    //     return this.json(imgObj);\n    //   }\n};"
    ]
}