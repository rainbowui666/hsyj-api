{
    "version": 3,
    "sources": [
        "../../../src/api/controller/scenery.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "page",
        "get",
        "size",
        "scenerytitle",
        "model",
        "_pk",
        "data",
        "countSelect",
        "where",
        "sceneryTitle",
        "arrdata",
        "item",
        "pics",
        "getPicsbyid",
        "sceneryID",
        "shstate",
        "getstate",
        "push",
        "success",
        "getscenerydetailAction",
        "id",
        "find",
        "think",
        "isEmpty",
        "discussList",
        "getDiscussById",
        "deleteAction",
        "update",
        "detailAction",
        "scenery",
        "getScenerybyid",
        "addEditAction",
        "post",
        "schoolid",
        "address",
        "shdesc",
        "longitude",
        "latitude",
        "soundurl",
        "videourl",
        "param",
        "insertid",
        "add",
        "json",
        "targetid",
        "delete"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/scenery.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n    async indexAction() {\n        const page = this.get('page') || 1;\n        const size = this.get('size') || 10;\n        const scenerytitle = this.get('scenerytitle') || '';\n\n        const model = this.model('scenery');\n        model._pk = 'sceneryID';\n\n        var data;\n        if (scenerytitle == '') {\n            data = await model.page(page, size).countSelect();\n        } else {\n            data = await model.where({sceneryTitle: ['like', `%${scenerytitle}%`]}).page(page, size).countSelect();\n        }\n        const arrdata = [];\n        for (const item of data.data) {\n            item.pics = await this.model('scenery').getPicsbyid(item.sceneryID);\n            item.shstate = await this.model('scenery').getstate(item.sceneryID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n        return this.success(data)\n    }\n\n    async getscenerydetailAction() {\n        const id = this.get('id');\n        const model = this.model('scenery');\n        model._pk = 'sceneryID';\n        const data = await model.where({sceneryID: id}).find();\n        if (!think.isEmpty(data)) {\n            data.pics = await this.model('scenery').getPicsbyid(data.sceneryID);\n            data.shstate = await this.model('scenery').getstate(data.sceneryID);\n            data.discussList = await this.model('discuss').getDiscussById(id,0);\n        }\n        return this.success(data);\n    }\n\n    async deleteAction() {\n        const id = this.get('id');\n        const data = {\n            shstate: 1\n        }\n        await this.model('scenery').where({sceneryID:id}).update(data);\n        return this.success('删除成功')\n    }\n\n    async detailAction() {\n        const id = this.get('id');\n        const model = this.model('scenery');\n        const data = await model.where({sceneryID: id}).find();\n\n        const arrdata = [];\n        // for (const item of data.data) {\n            data.scenery = await this.model('school').getScenerybyid(data.sceneryID);\n        //     // item.shstate = await this.model('school').getstate(item.schoolID);\n        //     arrdata.push(item);\n        // }\n        // data.data = arrdata;\n        return this.success(data)\n    }\n\n    async addEditAction() {\n        const sceneryTitle = this.post('scenerytitle');\n        const schoolid = this.post('schoolid');\n        const address = this.post('address') || '';\n        const shdesc= this.post('shdesc');\n        const longitude = this.post('longitude');\n        const latitude = this.post('latitude');\n        const soundurl = this.post('soundurl');\n        const videourl = this.post('videourl');\n        const id = this.get('id');\n\n        let param = {\n            sceneryTitle: sceneryTitle,\n            schoolid: schoolid,\n            address: address,\n            shdesc: shdesc,\n            longitude: longitude,\n            latitude: latitude,\n            soundurl,\n            videourl\n        }; \n        if (think.isEmpty(id)) {\n            let model = this.model('scenery');\n            const insertid = await model.add(param);\n            \n            // 上传景点图片\n            if (insertid) {\n                return this.json({\n                        insertid:insertid\n                    });\n            }\n        } else {\n            // 1 删除source, 2修改\n            await this.model('source').where({targetid:id}).delete();\n            await this.model('scenery').where({sceneryID:id}).update(param);\n            return this.success('景点修改成功')\n        }\n        \n    }\n}"
    ]
}