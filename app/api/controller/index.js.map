{
    "version": 3,
    "sources": [
        "../../../src/api/controller/index.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "User",
        "model",
        "select",
        "data",
        "cache",
        "console",
        "log",
        "success",
        "homeAction",
        "homedata",
        "think",
        "isEmpty",
        "_pk",
        "studentid",
        "get",
        "field",
        "where",
        "isrecommend",
        "shstate",
        "iscomplate",
        "order",
        "limit",
        "arrdata",
        "item",
        "pics",
        "getPicsbyid",
        "activityID",
        "joinnum",
        "getJoinNum",
        "joindate",
        "getStudentIsJoinActivity",
        "start",
        "Number",
        "Date",
        "startDate",
        "nowd",
        "end",
        "endDate",
        "hasjoin",
        "isAttentention",
        "push",
        "model2",
        "data2",
        "arrdata2",
        "sceneryID",
        "shortName",
        "schoolID",
        "schoolid",
        "getField",
        "schoolName",
        "alldata",
        "activitydata",
        "scenerydata",
        "getIndexDataAction"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/index.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n  async indexAction() {\n    const User = await this.model('user').select();\n\n  const data = await this.cache('rds_user');\n  console.log(data)\n    return this.success({\n      User: User\n    });\n  }\n\n  async homeAction() {\n\n    // await this.cache('home_activity_scenery', null)\n    // await this.cache('home_activity_scenery', null, 'redis')\n    const homedata = await this.cache('home_activity_scenery');\n    if (!think.isEmpty(homedata)) {\n      console.log('redis found data ...')\n      return this.success(homedata)\n    }\n    // 活动推荐\n    const model = this.model('activity');\n    model._pk = 'activityID';\n    const studentid = this.get('studentid');\n    const data = await model.field(['activityID', 'activityName', 'startDate','endDate','isGroup']).where({isrecommend:1, shstate:0, iscomplate: 1}).order('activityID desc').limit(0,5).select();\n    \n    const arrdata = [];\n    for (const item of data) {\n      item.pics = await this.model('activity').getPicsbyid(item.activityID);\n      item.joinnum = await this.model('student_activity').getJoinNum(item.activityID);\n      if (!think.isEmpty(studentid)) {\n        let joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,item.activityID, 1);\n        let start = Number(new Date(item.startDate));\n        let nowd = Number(new Date());\n        let end = Number(new Date(item.endDate));\n\n        // if (nowd > end && joindate && joindate.length > 0) {\n        //     item.hasjoin = '已完成'\n        // } else if (start < nowd && nowd < end) {\n        //   item.hasjoin = '进行中';\n        // } else if(joindate && joindate.length > 0) {\n        //     item.hasjoin = '已报名' \n        // }\n        if (nowd > end && joindate && joindate.iscomplate) {\n          item.hasjoin = '已完成'\n        } else if (start < nowd && nowd < end && (joindate && joindate.isAttentention)) {\n          item.hasjoin = '已报名,进行中';\n        } else if (start < nowd && nowd < end) {\n          item.hasjoin = '进行中';\n        } else if(joindate && joindate.isAttentention) {\n          item.hasjoin = '已报名' \n        }\n    } else {\n        let start = Number(new Date(item.startDate));\n        let nowd = Number(new Date());\n        let end = Number(new Date(item.endDate));\n\n        if (start < nowd && nowd < end) {\n            item.hasjoin = '进行中';\n        } else if (end < nowd) {\n            item.hasjoin = '已完成'\n        } else {\n            item.hasjoin = '未开始';\n        }\n    } \n    \n      arrdata.push(item);\n    }\n\n    // 景点推荐\n    const model2 = this.model('scenery');\n    model2._pk = 'sceneryID';\n    const data2 = await model2.field(['sceneryID', 'sceneryTitle','schoolid']).where({isrecommend:1, shstate:0}).order('sceneryID desc').limit(0,5).select();\n    \n    const arrdata2 = [];\n    for (const item of data2) {\n      item.pics = await this.model('scenery').getPicsbyid(item.sceneryID);\n      item.joinnum = await this.model('student_scenery').getJoinNum(item.sceneryID);\n      item.shortName = await this.model('school').field(['shortName']).where({schoolID: item.schoolid}).getField('shortName',true);\n      item.schoolName = await this.model('school').field(['schoolName']).where({schoolID: item.schoolid}).getField('schoolName',true);\n      arrdata2.push(item);\n    }\n\n    // console.log('write...')\n    let alldata = {activitydata: arrdata, scenerydata: arrdata2}\n    await this.cache('home_activity_scenery', alldata, 'redis')\n    return this.success(alldata)\n  }\n\n  async getIndexDataAction(){\n    // let rdsoption = {auth_pass:'000000'}\n\n    // var client = redis.createClient(6379,'127.0.0.1', rdsoption);\n\n    // client.auth('000000',function(){\n    //   console.log('pass......')\n    // })\n    // client.set('hello',\"{aa:'bb',dd:'1234'}\");\n\n    // client.get('hello',function (err,v) {\n    //     console.log(\"redis get hello err,v\",err,v);\n    // })\n  }\n};\n"
    ]
}