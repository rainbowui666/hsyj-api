{
    "version": 3,
    "sources": [
        "../../../src/api/controller/discuss.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "addAction",
        "distype",
        "get",
        "targetid",
        "studentid",
        "content",
        "post",
        "shstate",
        "model",
        "data",
        "insertid",
        "add",
        "success",
        "listAction",
        "pageindex",
        "pagesize",
        "sceneryid",
        "activityID",
        "schoolid",
        "typeconition",
        "scenerycondition",
        "activitycondition",
        "schoolcondition",
        "statusconditionn",
        "think",
        "isEmpty",
        "start",
        "query",
        "counta",
        "pagecount",
        "Math",
        "ceil",
        "t",
        "updateAction",
        "id",
        "where",
        "discussID",
        "update"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/discuss.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n    async addAction() {\n        const distype = this.get('distype');\n        const targetid = this.get('targetid') || 0;\n        const studentid = this.get('studentid');\n        const content = this.post('content');\n        const shstate = this.post('shstate') || 0;   \n\n        const model = this.model('discuss');\n        let data = {\n            distype,targetid,studentid,content,shstate\n        }\n\n        let insertid = await model.add(data);\n        return this.success('留言成功')\n    }\n\n    async listAction() {\n        const model =  this.model('discuss');\n        const pageindex = this.get('pageindex') || 1;\n        const pagesize = this.get('pagesize') || 5;\n        const shstate = this.get('shstate');\n        const distype = this.get('distype');\n        const sceneryid = this.get('sceneryid');\n        const activityID = this.get('activityid');\n        const schoolid = this.get('schoolid');\n\n        let typeconition = '';\n        let scenerycondition = '';\n        let activitycondition = '';\n        let schoolcondition = '';\n        let statusconditionn = '';\n\n        if (think.isEmpty(shstate)) {\n            statusconditionn = '1=1 ';\n        } else {\n            statusconditionn = 'a.shstate='+shstate\n        }\n\n        if (think.isEmpty(distype)) {\n            typeconition = '1=1 ';\n        } else {\n            typeconition = 'a.distype='+distype\n        }\n\n        if (think.isEmpty(sceneryid)) {\n            scenerycondition = '1=1 ';\n        } else {\n            scenerycondition = 'sceneryid='+sceneryid\n        }\n\n        if (think.isEmpty(activityID)) {\n            activitycondition = '1=1 ';\n        } else {\n            activitycondition = 'activityID='+activityID;\n        }\n\n        if (think.isEmpty(schoolid)) {\n            schoolcondition = '1=1 ';\n        } else {\n            schoolcondition = 'schoolID='+schoolid;\n        }\n\n        const start = (pageindex -1) * pagesize;\n        const data = await model.query(\"select a.discussID,s.studentName,a.distype,a.targetid,a.studentid,a.content,a.shstate,  case  when distype=0 then (select scenerytitle from culture_scenery where \"+scenerycondition+\" limit 1) when distype=1 then (select activityname from culture_activity where \"+activitycondition+\" limit 1) when distype=2 then (select schoolname from culture_school where \"+schoolcondition+\" limit 1) when distype=3 then \\\"APP首页\\\" end as targetaddress from culture_discuss a left join culture_student s on s.studentid=a.studentid where \"+typeconition+\" and \"+statusconditionn+\" and a.discussid order by discussID desc limit \"+start+\",\"+pagesize+\" \");\n        const counta = await model.query(\"select count(*) t from (select a.discussID,s.studentName,a.distype,a.targetid,a.studentid,a.content,a.shstate,  case  when distype=0 then (select scenerytitle from culture_scenery where \"+scenerycondition+\" limit 1) when distype=1 then (select activityname from culture_activity where \"+activitycondition+\" limit 1) when distype=2 then (select schoolname from culture_school where \"+schoolcondition+\" limit 1) when distype=3 then \\\"APP首页\\\" end as targetaddress from culture_discuss a left join culture_student s on s.studentid=a.studentid where \"+typeconition+\" and \"+statusconditionn+\" ) t \");\n        const pagecount = Math.ceil(counta[0].t / pagesize); //(counta[0].t + parseInt(pagesize - 1)) / pagesize;\n        return this.success({counta:counta[0].t,pagecount:pagecount,pageindex:pageindex,pagesize:pagesize,data})\n    }\n\n    async updateAction() {\n        const id = this.get('id');\n        const shstate = this.get('shstate');\n        const data = {\n            shstate\n        }\n\n        await this.model('discuss').where({discussID:id}).update(data);\n        return this.success('修改成功')\n    }\n}"
    ]
}