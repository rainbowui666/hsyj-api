{
    "version": 3,
    "sources": [
        "../../../src/api/controller/activity.js"
    ],
    "names": [
        "Base",
        "require",
        "_",
        "fs",
        "module",
        "exports",
        "getSwipeActAction",
        "model",
        "_pk",
        "data",
        "field",
        "where",
        "isrecommend",
        "shstate",
        "order",
        "limit",
        "select",
        "arrdata",
        "item",
        "pics",
        "getPicsbyid",
        "activityID",
        "joinnum",
        "getJoinNum",
        "push",
        "success",
        "frontListAction",
        "page",
        "get",
        "size",
        "studentid",
        "endDate",
        "Date",
        "date",
        "getFullYear",
        "getMonth",
        "getDate",
        "countSelect",
        "think",
        "isEmpty",
        "joindate",
        "isGroup",
        "getStudentIsJoinActivity",
        "getStudentIsJoinGroup2",
        "start",
        "Number",
        "startDate",
        "nowd",
        "end",
        "console",
        "log",
        "iscomplate",
        "hasjoin",
        "isAttentention",
        "needSchoolRangName",
        "getSchoolNameByIds",
        "needSchoolRang",
        "getstate",
        "getactivitydetailAction",
        "id",
        "find",
        "getactivitydetailForGroupAction",
        "groupId",
        "activityid",
        "getField",
        "groupData",
        "groupid",
        "length",
        "groupName",
        "moje",
        "uncodeUtf16",
        "group",
        "countgroupids",
        "uniq",
        "totalgroupstudents",
        "getActivityDiscussListAction",
        "discussList",
        "getDiscussById",
        "getActivitySceneryListAction",
        "pageindex",
        "pagesize",
        "idcondition",
        "query",
        "counta",
        "pagecount",
        "Math",
        "ceil",
        "t",
        "arrScen",
        "arrSchool",
        "sceneryState",
        "getstudentstate",
        "sceneryid",
        "schoolid",
        "complateSceneryNum",
        "complateSchoolNum",
        "count",
        "totalScenery",
        "totalSchool",
        "listAction",
        "userinfo",
        "getUserInfo",
        "ctx",
        "state",
        "token",
        "userId",
        "usertype",
        "datetime",
        "createbyuserid",
        "sysUserID",
        "sceneryCount",
        "questionCount",
        "sceneryRange",
        "getsceneryrangebyid",
        "list2Action",
        "list",
        "condition",
        "alias",
        "join",
        "table",
        "as",
        "on",
        "getActivityQuestionDetailAction",
        "questionid"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/activity.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst _ = require('lodash');\nconst fs = require('fs');\n\nmodule.exports = class extends Base {\n    async getSwipeActAction() {\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.field(['activityID', 'activityName']).where({isrecommend:1, shstate:0}).order('activityID desc').limit(0,5).select();\n        \n        const arrdata = [];\n        for (const item of data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityID);\n            item.joinnum = await this.model('student_activity').getJoinNum(item.activityID);\n            arrdata.push(item);\n        }\n\n        return this.success(data)\n    }\n\n    async frontListAction() {\n        const page = this.get('pageindex') || 1;\n        const size = this.get('pagesize') || 10;\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const endDate = new Date();\n        const date = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' 00:00:00'\n        // endDate:{'>': think.datetime(date,'YYYY-MM-DD')\n        const data = await model.order('activityID desc').page(page,size).countSelect();\n\n        const arrdata = [];\n\n        for (const item of data.data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityID);\n            if (!think.isEmpty(studentid)) {\n                \n                // let joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,item.activityID, 1);\n                let joindate = null;\n                if (item.isGroup == 0) {\n                    joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,item.activityID, 1);\n                } else {\n                    joindate = await this.model('student_activity').getStudentIsJoinGroup2(studentid,item.activityID, 1);\n                }\n\n                let start = Number(new Date(item.startDate));\n                let nowd = Number(new Date());\n                let end = Number(new Date(item.endDate));\n\n                if (joindate) {\n                    console.log('joindate---', joindate, start, nowd, end)\n                }\n\n                if (joindate && joindate.iscomplate) {\n                    item.hasjoin = '已完成'\n                } else if (start < nowd && nowd < end && (joindate && joindate.isAttentention)) {\n                    item.hasjoin = '已报名,进行中';\n                } else if (start < nowd && nowd < end) {\n                    item.hasjoin = '进行中';\n                } else if(joindate && joindate.isAttentention) {\n                    item.hasjoin = '已报名' \n                }\n                if(think.isEmpty(item.hasjoin) && nowd > end) item.hasjoin = '已结束';\n            } else {\n                let start = Number(new Date(item.startDate));\n                let nowd = Number(new Date());\n                let end = Number(new Date(item.endDate));\n\n                if (start < nowd && nowd < end) {\n                    item.hasjoin = '进行中';\n                } else if (end < nowd) {\n                    item.hasjoin = '已结束'\n                } else {\n                    item.hasjoin = '未开始';\n                }\n            } \n            item.needSchoolRangName = await this.model('school').getSchoolNameByIds(item.needSchoolRang);\n            item.shstate = await this.model('activity').getstate(item.activityID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n\n        return this.success(data)\n    }\n\n    async getactivitydetailAction() {\n        const id = this.get('id');\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.where({activityID: id}).find();\n\n        if (!think.isEmpty(data)) {\n            data.pics = await this.model('activity').getPicsbyid(data.activityID);\n            // data.discussList = await this.model('discuss').getDiscussById(id,1);\n            data.shstate = await this.model('activity').getstate(data.activityID);\n            if (!think.isEmpty(studentid)) {\n                let joindate = null;\n                if (data.isGroup == 0) {\n                    joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,data.activityID, 1);\n                } else {\n                    joindate = await this.model('student_activity').getStudentIsJoinGroup2(studentid,data.activityID, 1);\n                }\n                \n                let start = Number(new Date(data.startDate));\n                let nowd = Number(new Date());\n                let end = Number(new Date(data.endDate));\n\n                if (joindate && joindate.iscomplate) {\n                    data.hasjoin = '已完成'\n                } else if (start < nowd && nowd < end && (joindate && joindate.isAttentention)) {\n                    data.hasjoin = '已报名,进行中';\n                } else if (start < nowd && nowd < end) {\n                    data.hasjoin = '进行中';\n                } else if(joindate && joindate.isAttentention) {\n                    data.hasjoin = '已报名';\n                }\n                \n                if(think.isEmpty(data.hasjoin) && nowd > end) data.hasjoin = '已结束';\n            }\n        }\n        return this.success(data);\n    }\n\n    async getactivitydetailForGroupAction() {\n        const id = this.get('id');\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.where({activityID: id}).find();\n\n        if (!think.isEmpty(data)) {\n            data.pics = await this.model('activity').getPicsbyid(data.activityID);\n            // data.discussList = await this.model('discuss').getDiscussById(id,1);\n            data.shstate = await this.model('activity').getstate(data.activityID);\n            let joindate = await this.model('student_activity').getStudentIsJoinGroup2(studentid,data.activityID, 1);\n            let start = Number(new Date(data.startDate));\n            let nowd = Number(new Date());\n            let end = Number(new Date(data.endDate));\n\n            if (joindate && joindate.iscomplate) {\n                data.hasjoin = '已完成'\n            } else if (start < nowd && nowd < end && ((joindate && joindate.isAttentention))) {\n                data.hasjoin = '已报名,进行中';\n            } else if (start < nowd && nowd < end) {\n                data.hasjoin = '进行中';\n            } else if(joindate && joindate.isAttentention) {\n                data.hasjoin = '已报名' \n            }\n            if(think.isEmpty(data.hasjoin) && nowd > end) data.hasjoin = '已结束';\n            let groupId = await this.model('student_group').field('studentid').where({activityid: id,studentid: studentid}).getField('groupid');\n            let groupData = null;\n            if (!think.isEmpty(groupId)) groupData = await this.model('group').where({groupid:groupId}).select();\n            else groupData = await this.model('group').where({activityid:data.activityID, studentid: studentid}).select();\n            // console.log(this.uncodeUtf16(groupData[0].groupName))\n            if (groupData && groupData.length > 0 && groupData[0].groupName) {\n                let moje = this.uncodeUtf16(groupData[0].groupName);\n                groupData[0].groupName = moje;\n            }\n            data.group = groupData;\n            // console.log(data.group)\n\n            // 团队人数是否到达活动要求人数\n            if (!think.isEmpty(groupData)) {\n                let countgroupids = await this.model('student_group').field('studentid').where({activityid: id,groupid: groupData[0].groupid}).getField('studentid');\n                if (!think.isEmpty(countgroupids)) {\n                    countgroupids = _.uniq(countgroupids);\n                    data.totalgroupstudents = countgroupids.length;\n                } else {\n                    data.totalgroupstudents = 0;\n                }\n            } else {\n                data.totalgroupstudents = -1;\n            }\n        }\n        return this.success(data);\n    }\n\n    async getActivityDiscussListAction() {\n        const id = this.get('id');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.where({activityID: id}).find();\n        if (!think.isEmpty(data)) {\n            data.discussList = await this.model('discuss').getDiscussById(id,1);\n            \n        }\n        return this.success(data);\n    }\n\n    async getActivitySceneryListAction() {\n        const studentid = this.get('studentid');\n        const model =  this.model('activity_scenery');\n        const pageindex = this.get('pageindex') || 1;\n        const pagesize = this.get('pagesize') || 5;\n        const activityid = this.get('activityid');\n        const idcondition = activityid ? 'a.activityID=' + activityid : '1=1';\n        const start = (pageindex -1) * pagesize;\n        const data = await model.query(\"select distinct(s.sceneryid),s.activityid,a.activityName,a.startSceneryid,a.endSceneryid,sc.schoolid,sc.address,sc.shdesc,sc.longitude,sc.latitude,sc.sctype,sc.shstate,sc.sceneryTitle from culture_activity_scenery as s inner join culture_activity a on a.activityID=s.activityid inner join culture_scenery sc on s.sceneryid=sc.sceneryID where \"+idcondition+\" and a.activityID limit \"+start+\",\"+pagesize+\" \");\n        const counta = await model.query(\"select count(*) t from (select distinct(s.sceneryid),s.activityid,a.activityName,a.startSceneryid,a.endSceneryid,sc.schoolid,sc.address,sc.shdesc,sc.longitude,sc.latitude,sc.sctype,sc.shstate,sc.sceneryTitle from culture_activity_scenery as s inner join culture_activity a on a.activityID=s.activityid inner join culture_scenery sc on s.sceneryid=sc.sceneryID where \"+idcondition+\" ) t\");\n        const pagecount = Math.ceil(counta[0].t / pagesize);\n\n        const arrdata = [];\n        let arrScen = [];\n        let arrSchool = []\n        for (const item of data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityid);\n            item.shstate = await this.model('activity').getstate(item.activityid);\n            item.group = await this.model('student_group').where({activityid:activityid, studentid: studentid}).select();\n            if (!think.isEmpty(studentid)) {\n                item.sceneryState = await this.model('scenery').getstudentstate(item.sceneryid, studentid, item.activityid);\n            }\n\n            arrScen.push(item.sceneryid);\n            arrSchool.push(item.schoolid)\n            // item.question = await this.model('student_activity').studentJoinActivityAndAnswer(studentid,item.activityID,item.questionid)\n            arrdata.push(item)\n        }\n        let complateSceneryNum = 0;\n        let complateSchoolNum = 0;\n        if (!think.isEmpty(studentid)) {\n            complateSceneryNum = await this.model('attention_activity').where({studentid:studentid,activityid:activityid}).count();\n            complateSchoolNum = await this.model('student_school').where({studentid:studentid,shstate:1}).count();\n        } else {\n             complateSceneryNum = await this.model('attention_activity').where({activityid:activityid}).count();\n             complateSchoolNum = await this.model('student_school').where({shstate:1}).count();\n        }\n        arrScen = _.uniq(arrScen);\n        arrSchool = _.uniq(arrSchool);\n        \n        data.data = arrdata;\n        return this.success({counta:counta[0].t,pagecount:pagecount,pageindex:pageindex,pagesize:pagesize,totalScenery:arrScen,totalSchool:arrSchool,complateSceneryNum:complateSceneryNum,complateSchoolNum:complateSchoolNum,data})\n    }\n\n    async listAction() {\n        const page = this.get('pageindex') || 1;\n        const size = this.get('pagesize') || 10;\n        let userinfo = await this.model('pagecache').getUserInfo(this.ctx.state.token, this.ctx.state.userId); // '+ this.ctx.state.token);\n        console.log('session',userinfo)\n\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const endDate = new Date();\n        let date = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' 00:00:00';\n        // date = '2019-04-14 00:00:00';\n        // console.log('list', date)\n        let data = {};\n        if (userinfo && userinfo.usertype == 0) {\n            data = await model.where({shstate: 0, endDate:{'>': think.datetime(date,'YYYY-MM-DD')}, createbyuserid: userinfo.sysUserID}).order('activityID desc').page(page,size).countSelect();\n        } else {\n            data = await model.where({shstate: 0, endDate:{'>': think.datetime(date,'YYYY-MM-DD')}}).page(page,size).order('activityID desc').countSelect();\n        }\n        \n        const arrdata = [];\n\n        for (const item of data.data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityID);\n            item.sceneryCount = await this.model('activity_scenery').where({activityid:item.activityID}).count('activityid');\n            item.questionCount = 1; //await this.model('question').where({activityid:item.activityID}).count('activityid');\n            // console.log(Number(new Date(item.startDate)), Number(new Date()), Number(new Date(item.endDate)))\n        \n            item.needSchoolRangName = await this.model('school').getSchoolNameByIds(item.needSchoolRang);\n            item.sceneryRange = await this.model('activity_scenery').getsceneryrangebyid(item.activityID);\n            // item.shstate = await this.model('activity').getstate(item.activityID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n\n        return this.success(data)\n    }\n\n    async list2Action() {\n        const page = this.get('pageindex') || 1;\n        const size = this.get('pagesize') || 10;\n        let userinfo = await this.model('pagecache').getUserInfo(this.ctx.state.token, this.ctx.state.userId); // await this.cache('userinfo'+ this.ctx.state.token);\n        const activityid = this.get('activityid');\n\n\n        const model = this.model('question');\n        model._pk = 'questionID';\n        let list = [];\n        if (userinfo && userinfo && userinfo.usertype == 0) {\n            let condition = {};\n            if (think.isEmpty(activityid)|| activityid == 'undefined') {\n                condition = {'act.createbyuserid': userinfo.sysUserID, 'q.shstate':0, 'cs.shstate':0, 'act.shstate':0, 's.questionid': ['!=', null]};\n            } else {\n                condition = {'act.activityid':activityid,'act.createbyuserid': userinfo.sysUserID, 'q.shstate':0, 'cs.shstate':0, 'act.shstate':0, 's.questionid': ['!=', null]};\n            }\n            list = await model.field(['q.questionID','q.questiontitle','q.answera','q.answerb','q.answerc','q.answerd','q.rightanswer',\n                's.sceneryid','s.activityid','cs.sceneryTitle','act.startAddress'])\n            .alias('q')\n            .join({\n                table:'activity_scenery',\n                join:'left',\n                as: 's',\n                on: ['q.sceneryid', 's.sceneryid']\n            })\n            .join({\n                table:'scenery',\n                join: 'left',\n                as: 'cs',\n                on: ['cs.sceneryid','s.sceneryid']\n            })\n            .join({\n                table:'activity',\n                join:'left',\n                as: 'act',\n                on: ['act.activityID','s.activityid']\n            }).order('activityid desc').where(condition).page(page, size).countSelect();\n        } else {\n            let condition = {};\n            if (think.isEmpty(activityid) || activityid == 'undefined') {\n                condition = {1: 1, 'q.shstate':0, 'cs.shstate':0, 'act.shstate':0,'s.questionid': ['!=', null]};\n            } else {\n                condition = {'s.activityid': activityid, 'q.shstate':0, 'cs.shstate':0, 'act.shstate':0,'s.questionid': ['!=', null]};\n            }\n            list = await model.field(['q.questionID','q.questiontitle','q.answera','q.answerb','q.answerc','q.answerd','q.rightanswer',\n                's.sceneryid','s.activityid','cs.sceneryTitle','act.startAddress'])\n            .alias('q')\n            .join({\n                table:'activity_scenery',\n                join:'left',\n                as: 's',\n                on: ['q.sceneryid', 's.sceneryid']\n            })\n            .join({\n                table:'scenery',\n                join: 'left',\n                as: 'cs',\n                on: ['cs.sceneryid','s.sceneryid']\n            })\n            .join({\n                table:'activity',\n                join:'left',\n                as: 'act',\n                on: ['act.activityID','s.activityid']\n            }).where(condition).order('activityid desc').page(page, size).countSelect();\n        }\n        \n        return this.success(list)\n    }\n\n    async getActivityQuestionDetailAction() {\n        const questionid = this.get('questionid');\n        const activityid = this.get('activityid');\n        const model = this.model('question');\n        // model._pk = 'questionID';\n\n        let data =  await model.field(['q.questionID','q.questiontitle','q.answera','q.answerb','q.answerc','q.answerd','q.rightanswer',\n        's.sceneryid','s.activityid','cs.sceneryTitle','act.startAddress'])\n        .alias('q')\n        .join({\n            table:'activity_scenery',\n            join:'left',\n            as: 's',\n            on: ['q.questionID', 's.questionID']\n        })\n        .join({\n            table:'scenery',\n            join: 'left',\n            as: 'cs',\n            on: ['cs.sceneryid','s.sceneryid']\n        })\n        .join({\n            table:'activity',\n            join:'left',\n            as: 'act',\n            on: ['act.activityID','s.activityid']\n        }).where({'q.questionID': questionid, 's.activityid': activityid}).find();\n        return this.success(data)\n    }\n\n    \n}"
    ]
}