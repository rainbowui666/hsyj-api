{
    "version": 3,
    "sources": [
        "../../../src/api/controller/activity.js"
    ],
    "names": [
        "Base",
        "require",
        "_",
        "fs",
        "module",
        "exports",
        "frontListAction",
        "page",
        "get",
        "size",
        "studentid",
        "model",
        "_pk",
        "endDate",
        "Date",
        "date",
        "getFullYear",
        "getMonth",
        "getDate",
        "data",
        "where",
        "shstate",
        "order",
        "countSelect",
        "arrdata",
        "item",
        "pics",
        "getPicsbyid",
        "activityID",
        "Number",
        "startDate",
        "status",
        "joindate",
        "getStudentIsJoinActivity",
        "length",
        "hasjoin",
        "needSchoolRangName",
        "getSchoolNameByIds",
        "needSchoolRang",
        "getstate",
        "push",
        "success",
        "getactivitydetailAction",
        "id",
        "find",
        "think",
        "isEmpty",
        "getactivitydetailForGroupAction",
        "group",
        "activityid",
        "select",
        "getActivityDiscussListAction",
        "discussList",
        "getDiscussById",
        "getActivitySceneryListAction",
        "pageindex",
        "pagesize",
        "idcondition",
        "start",
        "query",
        "counta",
        "pagecount",
        "Math",
        "ceil",
        "t",
        "arrScen",
        "arrSchool",
        "sceneryid",
        "schoolid",
        "complateSceneryNum",
        "count",
        "complateSchoolNum",
        "uniq",
        "totalScenery",
        "totalSchool",
        "listAction",
        "userinfo",
        "cache",
        "console",
        "log",
        "usertype",
        "createbyuserid",
        "sysUserID",
        "sceneryCount",
        "questionCount",
        "list2Action",
        "list",
        "condition",
        "field",
        "alias",
        "join",
        "table",
        "as",
        "on",
        "getActivityQuestionDetailAction",
        "questionid"
    ],
    "mappings": "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",
    "file": "../../../src/api/controller/activity.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst _ = require('lodash');\nconst fs = require('fs');\n\nmodule.exports = class extends Base {\n    async frontListAction() {\n        const page = this.get('pageindex') || 1;\n        const size = this.get('pagesize') || 10;\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const endDate = new Date();\n        const date = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' 00:00:00'\n        const data = await model.where({shstate: 0, endDate:{'>': date}}).order('activityID desc').page(page,size).countSelect();\n\n        const arrdata = [];\n\n        for (const item of data.data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityID);\n            // console.log(Number(new Date(item.startDate)), Number(new Date()), Number(new Date(item.endDate)))\n            if (Number(new Date(item.startDate)) <= Number(new Date()) <= Number(new Date(item.endDate))) {\n                item.status='进行中';\n            } else {\n                item.status = '';\n            }\n            let joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,item.activityID);\n            if (Number(new Date()) > Number(new Date(item.endDate)) && joindate && joindate.length > 0) {\n                item.hasjoin = '已完成'\n            } else if(item.hasjoin = joindate && joindate.length > 0) {\n                item.hasjoin = '已报名' \n            } else {\n                item.hasjoin = '';\n            }\n            item.needSchoolRangName = await this.model('school').getSchoolNameByIds(item.needSchoolRang);\n            item.shstate = await this.model('activity').getstate(item.activityID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n\n        return this.success(data)\n    }\n\n    async getactivitydetailAction() {\n        const id = this.get('id');\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.where({activityID: id}).find();\n        if (!think.isEmpty(data)) {\n            data.pics = await this.model('activity').getPicsbyid(data.activityID);\n            // data.discussList = await this.model('discuss').getDiscussById(id,1);\n            data.shstate = await this.model('activity').getstate(data.activityID);\n            let joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,data.activityID);\n            if (Number(new Date()) > Number(new Date(data.endDate)) && joindate && joindate.length > 0) {\n                data.hasjoin = '已完成'\n            } else if(data.hasjoin = joindate && joindate.length > 0) {\n                data.hasjoin = '已报名' \n            } else {\n                data.hasjoin = '';\n            }\n        }\n        return this.success(data);\n    }\n\n    async getactivitydetailForGroupAction() {\n        const id = this.get('id');\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.where({activityID: id}).find();\n        if (!think.isEmpty(data)) {\n            data.pics = await this.model('activity').getPicsbyid(data.activityID);\n            // data.discussList = await this.model('discuss').getDiscussById(id,1);\n            data.shstate = await this.model('activity').getstate(data.activityID);\n            let joindate = await this.model('student_activity').getStudentIsJoinActivity(studentid,data.activityID);\n            if (Number(new Date()) > Number(new Date(data.endDate)) && joindate && joindate.length > 0) {\n                data.hasjoin = '已完成'\n            } else if(data.hasjoin = joindate && joindate.length > 0) {\n                data.hasjoin = '已报名' \n            } else {\n                data.hasjoin = '';\n            }\n            data.group=await this.model('group').where({activityid:data.activityID}).select();\n        }\n        return this.success(data);\n    }\n\n    async getActivityDiscussListAction() {\n        const id = this.get('id');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const data = await model.where({activityID: id}).find();\n        if (!think.isEmpty(data)) {\n            data.discussList = await this.model('discuss').getDiscussById(id,1);\n            \n        }\n        return this.success(data);\n    }\n\n    async getActivitySceneryListAction() {\n        const studentid = this.get('studentid');\n        const model =  this.model('activity_scenery');\n        const pageindex = this.get('pageindex') || 1;\n        const pagesize = this.get('pagesize') || 5;\n        const activityid = this.get('activityid');\n        const idcondition = activityid ? 'a.activityID=' + activityid : '1=1';\n        const start = (pageindex -1) * pagesize;\n        const data = await model.query(\"select s.*,a.activityName,a.startSceneryid,a.endSceneryid,sc.schoolid,sc.address,sc.shdesc,sc.longitude,sc.latitude,sc.sctype,sc.shstate,sc.sceneryTitle from culture_activity_scenery as s left join culture_activity a on a.activityID=s.activityid left join culture_scenery sc on s.sceneryid=sc.sceneryID where \"+idcondition+\" and a.activityID limit \"+start+\",\"+pagesize+\" \");\n        const counta = await model.query(\"select count(*) t from (select s.*,a.activityName,a.startSceneryid,a.endSceneryid,sc.schoolid,sc.address,sc.shdesc,sc.longitude,sc.latitude,sc.sctype,sc.shstate,sc.sceneryTitle from culture_activity_scenery as s left join culture_activity a on a.activityID=s.activityid left join culture_scenery sc on s.sceneryid=sc.sceneryID where \"+idcondition+\" ) t\");\n        const pagecount = Math.ceil(counta[0].t / pagesize);\n\n        const arrdata = [];\n        let arrScen = [];\n        let arrSchool = []\n        for (const item of data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityid);\n            item.shstate = await this.model('activity').getstate(item.activityid);\n            arrScen.push(item.sceneryid);\n            arrSchool.push(item.schoolid)\n            // item.question = await this.model('student_activity').studentJoinActivityAndAnswer(studentid,item.activityID,item.questionid)\n            arrdata.push(item)\n        }\n        let complateSceneryNum = await this.model('attention_activity').where({studentid:studentid,activityid:activityid}).count();\n        let complateSchoolNum = await this.model('student_school').where({studentid:studentid,shstate:1}).count();\n        arrScen = _.uniq(arrScen);\n        arrSchool = _.uniq(arrSchool);\n        \n        data.data = arrdata;\n        return this.success({counta:counta[0].t,pagecount:pagecount,pageindex:pageindex,pagesize:pagesize,totalScenery:arrScen,totalSchool:arrSchool,complateSceneryNum:complateSceneryNum,complateSchoolNum:complateSchoolNum,data})\n    }\n\n    async listAction() {\n        const page = this.get('pageindex') || 1;\n        const size = this.get('pagesize') || 10;\n        let userinfo = await this.cache('userinfo');\n        console.log('session',userinfo)\n\n        const studentid = this.get('studentid');\n        const model = this.model('activity');\n        model._pk = 'activityID';\n        const endDate = new Date();\n        const date = endDate.getFullYear()+'-'+(endDate.getMonth()+1)+'-'+endDate.getDate()+' 00:00:00'\n        let data = {};\n        if (userinfo && userinfo[0].usertype == 0) {\n            data = await model.where({shstate: 0, endDate:{'>': date}, createbyuserid: userinfo[0].sysUserID}).order('activityID desc').page(page,size).countSelect();\n        } else {\n            data = await model.where({shstate: 0, endDate:{'>': date}}).page(page,size).order('activityID desc').countSelect();\n        }\n        \n        const arrdata = [];\n\n        for (const item of data.data) {\n            item.pics = await this.model('activity').getPicsbyid(item.activityID);\n            item.sceneryCount = await this.model('activity_scenery').where({activityid:item.activityID}).count('activityid');\n            item.questionCount = 1; //await this.model('question').where({activityid:item.activityID}).count('activityid');\n            // console.log(Number(new Date(item.startDate)), Number(new Date()), Number(new Date(item.endDate)))\n        \n            item.needSchoolRangName = await this.model('school').getSchoolNameByIds(item.needSchoolRang);\n            // item.shstate = await this.model('activity').getstate(item.activityID);\n            arrdata.push(item);\n        }\n        data.data = arrdata;\n\n        return this.success(data)\n    }\n\n    async list2Action() {\n        const page = this.get('pageindex') || 1;\n        const size = this.get('pagesize') || 10;\n        let userinfo = await this.cache('userinfo');\n        const activityid = this.get('activityid');\n\n\n        const model = this.model('question');\n        model._pk = 'questionID';\n        let list = [];\n        if (userinfo && userinfo[0] && userinfo[0].usertype == 0) {\n            console.log('aaa')\n            let condition = {};\n            if (think.isEmpty(activityid)|| activityid == 'undefined') {\n                condition = {createbyuserid: userinfo[0].sysUserID};\n            } else {\n                condition = {'s.activityid':activityid,createbyuserid: userinfo[0].sysUserID};\n            }\n            list = await model.field(['q.questionID','q.questiontitle','q.answera','q.answerb','q.answerc','q.answerd','q.rightanswer',\n                's.sceneryid','s.activityid','cs.sceneryTitle','act.startAddress'])\n            .alias('q')\n            .join({\n                table:'activity_scenery',\n                join:'left',\n                as: 's',\n                on: ['q.questionID', 's.questionID']\n            })\n            .join({\n                table:'scenery',\n                join: 'left',\n                as: 'cs',\n                on: ['cs.sceneryid','s.sceneryid']\n            })\n            .join({\n                table:'activity',\n                join:'left',\n                as: 'act',\n                on: ['act.activityID','s.activityid']\n            }).order('activityid desc').where(condition).page(page, size).countSelect();\n        } else {\n            console.log('bbb')\n            let condition = {};\n            if (think.isEmpty(activityid) || activityid == 'undefined') {\n                condition = {1: 1};\n            } else {\n                condition['s.activityid'] = activityid;\n            }\n            list = await model.field(['q.questionID','q.questiontitle','q.answera','q.answerb','q.answerc','q.answerd','q.rightanswer',\n                's.sceneryid','s.activityid','cs.sceneryTitle','act.startAddress'])\n            .alias('q')\n            .join({\n                table:'activity_scenery',\n                join:'left',\n                as: 's',\n                on: ['q.questionID', 's.questionID']\n            })\n            .join({\n                table:'scenery',\n                join: 'left',\n                as: 'cs',\n                on: ['cs.sceneryid','s.sceneryid']\n            })\n            .join({\n                table:'activity',\n                join:'left',\n                as: 'act',\n                on: ['act.activityID','s.activityid']\n            }).where(condition).order('activityid desc').page(page, size).countSelect();\n        }\n        \n        return this.success(list)\n    }\n\n    async getActivityQuestionDetailAction() {\n        const questionid = this.get('questionid');\n        const activityid = this.get('activityid');\n        const model = this.model('question');\n        // model._pk = 'questionID';\n\n        let data =  await model.field(['q.questionID','q.questiontitle','q.answera','q.answerb','q.answerc','q.answerd','q.rightanswer',\n        's.sceneryid','s.activityid','cs.sceneryTitle','act.startAddress'])\n        .alias('q')\n        .join({\n            table:'activity_scenery',\n            join:'left',\n            as: 's',\n            on: ['q.questionID', 's.questionID']\n        })\n        .join({\n            table:'scenery',\n            join: 'left',\n            as: 'cs',\n            on: ['cs.sceneryid','s.sceneryid']\n        })\n        .join({\n            table:'activity',\n            join:'left',\n            as: 'act',\n            on: ['act.activityID','s.activityid']\n        }).where({'q.questionID': questionid, 's.activityid': activityid}).find();\n        return this.success(data)\n    }\n\n    \n}"
    ]
}