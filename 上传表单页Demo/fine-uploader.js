/*!
* Fine Uploader
*
* Copyright 2015, Widen Enterprises, Inc. info@fineuploader.com
*
* Version: 5.1.3
*
* Homepage: http://fineuploader.com
*
* Repository: git://github.com/Widen/fine-uploader.git
*
* Licensed only under the Widen Commercial License (http://fineuploader.com/licensing).
*/var qq=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),function(){qq(e).detach(t,n)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return t?e===t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8):!1},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(t){if(e.style==null)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters!="undefined"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t),this},hasClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)},addClass:function(t){return qq(e).hasClass(t)||(e.className+=" "+t),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(t){var n,r=[];return e.querySelectorAll?e.querySelectorAll("."+t):(n=e.getElementsByTagName("*"),qq.each(n,function(e,n){qq(n).hasClass(t)&&r.push(n)}),r)},children:function(){var t=[],n=e.firstChild;while(n)n.nodeType===1&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?e.hasAttribute(t)?/^false$/i.exec(e.getAttribute(t))==null:!1:(n=e[t],n===undefined?!1:/^false$/i.exec(n)==null)}}};(function(){"use strict";qq.canvasToBlob=function(e,t,n){return qq.dataUriToBlob(e.toDataURL(t,n))},qq.dataUriToBlob=function(e){var t,n,r=function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})},i,s;return e.split(",")[0].indexOf("base64")>=0?n=atob(e.split(",")[1]):n=decodeURI(e.split(",")[1]),s=e.split(",")[0].split(":")[1].split(";")[0],t=new ArrayBuffer(n.length),i=new Uint8Array(t),qq.each(n,function(e,t){i[e]=t.charCodeAt(0)}),r(t,s)},qq.log=function(e,t){window.console&&(!t||t==="info"?window.console.log(e):window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e))},qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"},qq.isFunction=function(e){return typeof e=="function"},qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"},qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem},qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},qq.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");return qq.each(t,function(e,t){var i=n.substring(0,r),s=n.substring(r+2);n=i+t+s,r=n.indexOf("{}",r+t.length);if(r<0)return!1}),n},qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"},qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"},qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)},qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?n!=="file":n==="file"};return window.HTMLInputElement&&Object.prototype.toString.call(e)==="[object HTMLInputElement]"&&e.type&&n(e.type)?!0:e.tagName&&e.tagName.toLowerCase()==="input"&&e.type&&n(e.type)?!0:!1},qq.isBlob=function(e){if(window.Blob&&Object.prototype.toString.call(e)==="[object Blob]")return!0},qq.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",e.multiple!==undefined&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof qq.createXhrInstance().upload!="undefined"},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)},qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)},qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);return qq.each(n,function(e,n){var r=n.toString(16);r.length<2&&(r="0"+r),t+=r}),t},qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),i=new FileReader,s=new qq.Promise;return i.onload=function(){s.success(qq.arrayBufferToHex(i.result))},i.onerror=s.failure,i.readAsArrayBuffer(r),s},qq.extend=function(e,t,n){return qq.each(t,function(t,r){n&&qq.isObject(r)?(e[t]===undefined&&(e[t]={}),qq.extend(e[t],r,!0)):e[t]=r}),e},qq.override=function(e,t){var n={},r=t(n);return qq.each(r,function(t,r){e[t]!==undefined&&(n[t]=e[t]),e[t]=r}),e},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;n<0&&(n+=r);for(;n<r;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},qq.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},qq.ie11=function(){return qq.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1},qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1},qq.opera=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Opera")!==-1},qq.firefox=function(){return!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""},qq.windows=function(){return navigator.platform==="Win32"},qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},qq.ios8=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},qq.ios800=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},qq.iosChrome=function(){return qq.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.each=function(e,t){var n,r;if(e)if(window.Storage&&e.constructor===window.Storage)for(n=0;n<e.length;n++){r=t(e.key(n),e.getItem(e.key(n)));if(r===!1)break}else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e))for(n=0;n<e.length;n++){r=t(n,e[n]);if(r===!1)break}else if(qq.isString(e))for(n=0;n<e.length;n++){r=t(n,e.charAt(n));if(r===!1)break}else for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){r=t(n,e[n]);if(r===!1)break}},qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);return arguments.length&&(r=r.concat(Array.prototype.slice.call(arguments))),e.apply(t,r)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(e,t,n){var r=[],i="&",s=function(e,n){var i=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;i!=="undefined"&&n!=="undefined"&&r.push(typeof e=="object"?qq.obj2url(e,i,!0):Object.prototype.toString.call(e)==="[object Function]"?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))};return!n&&t?(i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e))):Object.prototype.toString.call(e)==="[object Array]"&&typeof e!="undefined"?qq.each(e,function(e,t){s(t,e)}):typeof e!="undefined"&&e!==null&&typeof e=="object"?qq.each(e,function(e,t){s(t,e)}):r.push(encodeURIComponent(t)+"="+encodeURIComponent(e)),t?r.join(i):r.join(i).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(e,t,n){return t||(t=new FormData),qq.each(e,function(e,r){e=n?n+"["+e+"]":e,qq.isObject(r)?qq.obj2FormData(r,t,e):qq.isFunction(r)?t.append(e,r()):t.append(e,r)}),t},qq.obj2Inputs=function(e,t){var n;return t||(t=document.createElement("form")),qq.obj2FormData(e,{append:function(e,r){n=document.createElement("input"),n.setAttribute("name",e),n.setAttribute("value",r),t.appendChild(n)}}),t},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},qq.getFilename=function(e){return qq.isInput(e)?e.value.replace(/.*(\/|\\)/,""):qq.isFile(e)&&e.fileName!==null&&e.fileName!==undefined?e.fileName:e.name},qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})(),function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e},qq.Error.prototype=new Error}(),qq.version="5.1.3",qq.supportedFeatures=function(){"use strict";function d(){var e=!0,t;try{t=document.createElement("input"),t.type="file",qq(t).hide(),t.disabled&&(e=!1)}catch(n){e=!1}return e}function v(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function m(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}function g(){if(window.XMLHttpRequest){var e=qq.createXhrInstance();return e.withCredentials!==undefined}return!1}function y(){return window.XDomainRequest!==undefined}function b(){return g()?!0:y()}function w(){return document.createElement("input").webkitdirectory!==undefined}function E(){try{return!!window.localStorage}catch(e){return!1}}var e,t,n,r,i,s,o,u,a,f,l,c,h,p;return e=d(),n=e&&qq.isXhrUploadSupported(),t=n&&!qq.androidStock(),r=n&&v(),i=n&&qq.isFileChunkingSupported(),s=n&&i&&E(),o=n&&m(),u=e&&(window.postMessage!==undefined||n),f=g(),a=y(),l=b(),c=w(),h=n&&window.FileReader!==undefined,p=function(){return n?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:n,blobUploading:t,canDetermineSize:n,chunking:i,deleteFileCors:l,deleteFileCorsXdr:a,deleteFileCorsXhr:f,fileDrop:n,folderDrop:r,folderSelection:c,imagePreviews:h,imageValidation:h,itemSizeValidation:n,pause:i,progressBar:p,resume:s,scaling:h&&t,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:e,uploadCors:u,uploadCustomHeaders:n,uploadNonMultipart:n,uploadViaPaste:o}}(),qq.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&qq.isFunction(e.then))},qq.Promise=function(){"use strict";var e,t,n=[],r=[],i=[],s=0;qq.extend(this,{then:function(i,o){return s===0?(i&&n.push(i),o&&r.push(o)):s===-1?o&&o.apply(null,t):i&&i.apply(null,e),this},done:function(n){return s===0?i.push(n):n.apply(null,t===undefined?e:t),this},success:function(){return s=1,e=arguments,n.length&&qq.each(n,function(t,n){n.apply(null,e)}),i.length&&qq.each(i,function(t,n){n.apply(null,e)}),this},failure:function(){return s=-1,t=arguments,r.length&&qq.each(r,function(e,n){n.apply(null,t)}),i.length&&qq.each(i,function(e,n){n.apply(null,t)}),this}})},qq.BlobProxy=function(e,t){"use strict";qq.extend(this,{referenceBlob:e,create:function(){return t(e)}})},qq.UploadButton=function(e){"use strict";function o(){var e=document.createElement("input");return e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,s),t.setMultiple(r.multiple,e),r.folders&&qq.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),r.acceptFiles&&e.setAttribute("accept",r.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",r.name),qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(e).css({height:"100%"}),r.element.appendChild(e),n.attach(e,"change",function(){r.onChange(e)}),n.attach(e,"mouseover",function(){qq(r.element).addClass(r.hoverClass)}),n.attach(e,"mouseout",function(){qq(r.element).removeClass(r.hoverClass)}),n.attach(e,"focus",function(){qq(r.element).addClass(r.focusClass)}),n.attach(e,"blur",function(){qq(r.element).removeClass(r.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}var t=this,n=new qq.DisposeSupport,r={element:null,multiple:!1,acceptFiles:null,folders:!1,name:"qqfile",onChange:function(e){},ios8BrowserCrashWorkaround:!0,hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},i,s;qq.extend(r,e),s=qq.getUniqueId(),qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return i},getButtonId:function(){return s},setMultiple:function(e,t){var n=t||this.getInput();r.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?n.setAttribute("multiple",""):e?n.setAttribute("multiple",""):n.removeAttribute("multiple")},setAcceptFiles:function(e){e!==r.acceptFiles&&i.setAttribute("accept",e)},reset:function(){i.parentNode&&qq(i).remove(),qq(r.element).removeClass(r.focusClass),i=null,i=o()}}),i=o()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(e){"use strict";function o(e){if(qq.isArray(e)){var n=[];return qq.each(e,function(e,r){n.push(t[r])}),n}return t[e]}function u(e){if(qq.isArray(e)){var r=[];return qq.each(e,function(e,i){r.push(t[n[i]])}),r}return t[n[e]]}function a(e){var n=[],i=[].concat(e);return qq.each(i,function(e,i){var s=r[i];s!==undefined&&qq.each(s,function(e,r){n.push(t[r])})}),n}var t=[],n={},r={},i={},s={};qq.extend(this,{addFile:function(o){var u=o.status||qq.status.SUBMITTING,a=t.push({name:o.name,originalName:o.name,uuid:o.uuid,size:o.size||-1,status:u})-1;return o.batchId&&(t[a].batchId=o.batchId,s[o.batchId]===undefined&&(s[o.batchId]=[]),s[o.batchId].push(a)),o.proxyGroupId&&(t[a].proxyGroupId=o.proxyGroupId,i[o.proxyGroupId]===undefined&&(i[o.proxyGroupId]=[]),i[o.proxyGroupId].push(a)),t[a].id=a,n[o.uuid]=a,r[u]===undefined&&(r[u]=[]),r[u].push(a),e.onStatusChange(a,null,u),a},retrieve:function(e){if(!qq.isObject(e)||!t.length)return qq.extend([],t,!0);if(e.id!==undefined)return o(e.id);if(e.uuid!==undefined)return u(e.uuid);if(e.status)return a(e.status)},reset:function(){t=[],n={},r={},s={}},setStatus:function(n,i){var s=t[n].status,o=qq.indexOf(r[s],n);r[s].splice(o,1),t[n].status=i,r[i]===undefined&&(r[i]=[]),r[i].push(n),e.onStatusChange(n,s,i)},uuidChanged:function(e,r){var i=t[e].uuid;t[e].uuid=r,n[r]=e,delete n[i]},updateName:function(e,n){t[e].name=n},updateSize:function(e,n){t[e].size=n},setParentId:function(e,n){t[e].parentId=n},getIdsInProxyGroup:function(e){var n=t[e].proxyGroupId;return n?i[n]:[]},getIdsInBatch:function(e){var n=t[e].batchId;return s[n]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addFiles:function(e,t,n){this._maybeHandleIos8SafariWorkaround();var r=this._storedIds.length===0?qq.getUniqueId():this._currentBatchId,i=qq.bind(function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},r,c)},this),s=qq.bind(function(e){this._handleNewFile(e,r,c)},this),o=qq.bind(function(e){var t=qq.canvasToBlob(e);this._handleNewFile({blob:t,name:this._options.blobs.defaultName+".png"},r,c)},this),u=qq.bind(function(e){var t=e.quality&&e.quality/100,n=qq.canvasToBlob(e.canvas,e.type,t);this._handleNewFile({blob:n,name:e.name},r,c)},this),a=qq.bind(function(e){if(qq.isInput(e)&&qq.supportedFeatures.ajaxUploading){var t=Array.prototype.slice.call(e.files);qq.each(t,function(e,t){this._handleNewFile(t,r,c)})}else this._handleNewFile(e,r,c)},this),f=function(){qq.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},l=this,c=[];this._currentBatchId=r,e&&(f(),qq.each(e,function(e,t){qq.isFileOrInput(t)?a(t):qq.isBlob(t)?i(t):qq.isObject(t)?t.blob&&t.name?s(t):t.canvas&&t.name&&u(t):t.tagName&&t.tagName.toLowerCase()==="canvas"?o(t):l.log(t+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+c.length+" files."),this._prepareItemsForUpload(c,t,n))},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds),qq.each(e,function(e,n){t.cancel(n)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});return!qq.supportedFeatures.pause||!this._options.chunking.enabled?!1:t.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1)},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,t,n,r){var i=new qq.Promise,s,o;return this._imageGenerator?(s=this._thumbnailUrls[e],o={scale:n>0,maxSize:n>0?n:null},!r&&qq.supportedFeatures.imagePreviews&&(s=this.getFile(e)),s==null?i.failure({container:t,error:"File or URL not found."}):this._imageGenerator.generate(s,t,o).then(function(t){i.success(t)},function(t,n){i.failure({container:t,error:n||"Problem generating thumbnail"})})):i.failure({container:t,error:"Missing image generator module"}),i},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){return this._handler.getFile(e)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&t.parentId!==undefined&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},log:function(e,t){this._options.debug&&(!t||t==="info")?qq.log("[Fine Uploader "+qq.version+"] "+e):t&&t!=="info"&&qq.log("[Fine Uploader "+qq.version+"] "+e,t)},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,t){var n=this;return qq.Scaler.prototype.scaleImage(e,t,{log:qq.bind(n.log,n),getFile:qq.bind(n.getFile,n),uploadData:n._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},uploadStoredFiles:function(){var e;if(this._storedIds.length===0)this._itemError("noFilesError");else while(this._storedIds.length)e=this._storedIds.shift(),this._uploadFile(e)}},qq.basePrivateApi={_addCannedFile:function(e){var t=this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:qq.status.UPLOAD_SUCCESSFUL});return e.deleteFileEndpoint&&this.setDeleteFileEndpoint(e.deleteFileEndpoint,t),e.deleteFileParams&&this.setDeleteFileParams(e.deleteFileParams,t),e.thumbnailUrl&&(this._thumbnailUrls[t]=e.thumbnailUrl),this._netUploaded++,this._netUploadedOrQueued++,t},_annotateWithButtonId:function(e,t){qq.isFile(e)&&(e.qqButtonId=this._getButtonId(t))},_batchError:function(e){this._options.callbacks.onError(null,null,e,undefined)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r),e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createStore:function(e,t){var n={},r=e,i={},s=function(e){return qq.isObject(e)?qq.extend({},e):e},o=function(){return qq.isFunction(t)?t():t},u=function(e,n){t&&qq.isObject(n)&&qq.extend(n,o()),i[e]&&qq.extend(n,i[e])};return{set:function(e,t){t==null?(n={},r=s(e)):n[t]=s(e)},get:function(e){var t;return e!=null&&n[e]?t=n[e]:t=s(r),u(e,t),s(t)},addReadOnly:function(e,t){qq.isObject(n)&&(i[e]=i[e]||{},qq.extend(i[e],t))},remove:function(e){return delete n[e]},reset:function(){n={},i={},r=e}}},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r),e._options.callbacks.onStatusChange(t,n,r),e._maybeAllComplete(t,r),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,r)},0)}})},_createUploadButton:function(e){function s(){return qq.supportedFeatures.ajaxUploading?t._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&t._isAllowedExtension(r,".mov")?!1:e.multiple===undefined?t._options.multiple:e.multiple:!1}var t=this,n=e.accept||this._options.validation.acceptFiles,r=e.allowedExtensions||this._options.validation.allowedExtensions,i;return i=new qq.UploadButton({element:e.element,folders:e.folders,name:this._options.request.inputName,multiple:s(),acceptFiles:n,onChange:function(e){t._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash}),this._disposeSupport.addDisposer(function(){i.dispose()}),t._buttons.push(i),i},_createUploadHandler:function(e,t){var n=this,r={},i={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,i,s){if(i<0||s<0)return;if(r[e]){if(r[e].loaded!==i||r[e].total!==s)n._onProgress(e,t,i,s),n._options.callbacks.onProgress(e,t,i,s)}else n._onProgress(e,t,i,s),n._options.callbacks.onProgress(e,t,i,s);r[e]={loaded:i,total:s}},onComplete:function(e,t,i,s){delete r[e];var o=n.getUploads({id:e}).status,u;if(o===qq.status.UPLOAD_SUCCESSFUL||o===qq.status.UPLOAD_FAILED)return;u=n._onComplete(e,t,i,s),u instanceof qq.Promise?u.done(function(){n._options.callbacks.onComplete(e,t,i,s)}):n._options.callbacks.onComplete(e,t,i,s)},onCancel:function(e,t,r){var i=new qq.Promise;return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onFailure:i.failure,onSuccess:function(){r.then(function(){n._onCancel(e,t)}),i.success()},identifier:e}),i},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(e,t){n._onUpload(e,t),n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,r){n._onUploadChunk(e,r),n._options.callbacks.onUploadChunk(e,t,r)},onUploadChunkSuccess:function(e,t,r,i){n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,r){return n._options.callbacks.onResume(e,t,r)},onAutoRetry:function(e,t,r,i){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'"),n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n),setSize:qq.bind(n._setSize,n),getDataByUuid:function(e){return n.getUploads({uuid:e})},isQueued:function(e){var t=n.getUploads({id:e}).status;return t===qq.status.QUEUED||t===qq.status.SUBMITTED||t===qq.status.UPLOAD_RETRYING||t===qq.status.PAUSED},getIdsInProxyGroup:n._uploadData.getIdsInProxyGroup,getIdsInBatch:n._uploadData.getIdsInBatch};return qq.each(this._options.request,function(e,t){i[e]=t}),i.customHeaders=this._customHeadersStore,e&&qq.each(e,function(e,t){i[e]=t}),new qq.UploadHandlerController(i,t)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.REJECTED)},_formatSize:function(e){var t=-1;do e/=1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,i=qq.extend({},e._options.validation,!0),s=qq.extend({},n);r===undefined&&(r=e._options.multiple),s.validation&&qq.extend(i,n.validation,!0),qq.extend(s,{multiple:r,validation:i},!0),e._initExtraButton(s)})},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t)return t.element;if(e===this._defaultButtonId)return this._options.button},_getButtonId:function(e){var t,n,r=e;r instanceof qq.BlobProxy&&(r=r.referenceBlob);if(r&&!qq.isBlob(r)){if(qq.isFile(r))return r.qqButtonId;if(r.tagName.toLowerCase()==="input"&&r.type.toLowerCase()==="file")return r.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);t=r.getElementsByTagName("input"),qq.each(t,function(e,t){if(t.getAttribute("type")==="file")return n=t,!1});if(n)return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof qq.BlobProxy?{name:qq.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var t=this,n=[];return qq.each(e,function(e,r){n.push(t._getValidationDescriptor(r))}),n},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=this._options;n&&n!==this._defaultButtonId&&(r=this._extraButtonSpecs[n]),r.multiple=!1,r.validation.acceptFiles===null?r.validation.acceptFiles=e:r.validation.acceptFiles+=","+e,qq.each(this._buttons,function(e,t){if(t.getButtonId()===n)return t.setMultiple(r.multiple),t.setAcceptFiles(r.acceptFiles),!1})}},_handleCheckedCallback:function(e){var t=this,n=e.callback();return qq.isGenericPromise(n)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),n.then(function(n){t.log(e.name+" promise success for "+e.identifier),e.onSuccess(n)},function(){e.onFailure?(t.log(e.name+" promise failure for "+e.identifier),e.onFailure()):t.log(e.name+" promise failure for "+e.identifier)})):(n!==!1?e.onSuccess(n):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),n)},_handleNewFile:function(e,t,n){var r=this,i=qq.getUniqueId(),s=-1,o=qq.getFilename(e),u=e.blob||e,a=this._customNewFileHandler?this._customNewFileHandler:qq.bind(r._handleNewFileGeneric,r);!qq.isInput(u)&&u.size>=0&&(s=u.size),a(u,o,i,s,n,t,this._options.request.uuidName,{uploadData:r._uploadData,paramsStore:r._paramsStore,addFileToHandler:function(e,t){r._handler.add(e,t),r._netUploadedOrQueued++,r._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,r,i,s){var o=this._uploadData.addFile({uuid:n,name:t,size:r,batchId:s});this._handler.add(o,e),this._trackButton(o),this._netUploadedOrQueued++,i.push({id:o,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;r==null&&(r=this._options.paste.defaultName),r+="."+n,this.addFiles({name:r,blob:e})},_initExtraButton:function(e){var t=this._createUploadButton({element:e.element,multiple:e.multiple,accept:e.validation.acceptFiles,folders:e.folders,allowedExtensions:e.validation.allowedExtensions});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible
:function(){return!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled?!1:this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr?!0:qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0},_isAllowedExtension:function(e,t){var n=!1;return e.length?(qq.each(e,function(e,r){if(qq.isString(r)){var i=new RegExp("\\."+r+"$","i");if(t.match(i)!=null)return n=!0,!1}}),n):!0},_itemError:function(e,t,n){function c(e,t){r=r.replace(e,t)}var r=this._options.messages[e],i=[],s=[].concat(t),o=s[0],u=this._getButtonId(n),a=this._getValidationBase(u),f,l;return qq.each(a.allowedExtensions,function(e,t){qq.isString(t)&&i.push(t)}),f=i.join(", ").toLowerCase(),c("{file}",this._options.formatFileName(o)),c("{extensions}",f),c("{sizeLimit}",this._formatSize(a.sizeLimit)),c("{minSizeLimit}",this._formatSize(a.minSizeLimit)),l=r.match(/(\{\w+\})/g),l!==null&&qq.each(l,function(e,t){c(t,s[e])}),this._options.callbacks.onError(null,o,r,undefined),r},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),t?t(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,t){var n=this,r=this._getNotFinished();t===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):t===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),r===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){n._onAllComplete(n._succeededSinceLastAllComplete,n._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success)if(r&&r.status!==200&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r);else{var i=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,i,r)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,i){var s=this;if(t.length>n)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=s._getValidationDescriptor(t[n]),o=s._getButtonId(t[n].file),u=s._getButton(o);s._handleCheckedCallback({name:"onValidate",callback:qq.bind(s._options.callbacks.onValidate,s,e,u),onSuccess:qq.bind(s._onValidateCallbackSuccess,s,t,n,r,i),onFailure:qq.bind(s._onValidateCallbackFailure,s,t,n,r,i),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;n<t.length;n++)s._fileOrBlobRejected(t[n].id)},_onAllComplete:function(e,t){this._totalProgress&&this._totalProgress.onAllComplete(e,t,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],e),qq.extend([],t)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,t,n,r,i){var s=this;s._preventRetries[e]=n[s._options.retry.preventRetryResponseProperty];if(s._shouldAutoRetry(e,t,n))return s._maybeParseAndSendUploadError.apply(s,arguments),s._options.callbacks.onAutoRetry(e,t,s._autoRetries[e]),s._onBeforeAutoRetry(e,t),s._retryTimeouts[e]=setTimeout(function(){s.log("Retrying "+t+"..."),s._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING),i?i(e):s._handler.retry(e)},s._options.retry.autoAttemptDelay*1e3),!0},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t=this._currentItemLimit,n;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(n=this.getName(e),this._options.callbacks.onManualRetry(e,n)===!1?!1:t>0&&this._netUploadedOrQueued+1>t?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+n+"' (id: "+e+")..."),!0)):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,t){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);!this._options.autoUpload&&n>=0&&this._storedIds.splice(n,1),this._uploadData.setStatus(e,qq.status.CANCELED)},_onComplete:function(e,t,n,r){return n.success?(n.thumbnailUrl&&(this._thumbnailUrls[e]=n.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED),n[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,t,n,r),n.success?!0:!1},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){var r=this.getName(e);n?(this._uploadData.setStatus(e,qq.status.DELETE_FAILED),this.log("Delete request for '"+r+"' has failed.","error"),t.withCredentials===undefined?this._options.callbacks.onError(e,r,"Delete request failed",t):this._options.callbacks.onError(e,r,"Delete request failed with response code "+t.status,t)):(this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,qq.status.DELETED),this.log("Delete request for '"+r+"' has succeeded."))},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++)this._annotateWithButtonId(e.files[t],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);qq.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,n,r){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,r)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.callbacks.onSubmitted.apply(this,arguments),this._options.autoUpload?this._uploadFile(e):this._storeForLater(e)},_onSubmitDelete:function(e,t,n){var r=this.getUuid(e),i;return t&&(i=qq.bind(t,this,e,r,n)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:i||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible "+"due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadStatusChange:function(e,t,n){n===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(e,n){t._fileOrBlobRejected(n.id)})},_onValidateBatchCallbackSuccess:function(e,t,n,r,i){var s,o=this._currentItemLimit,u=this._netUploadedOrQueued;o===0||u<=o?t.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],i),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(t),s=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,u).replace(/\{itemLimit\}/g,o),this._batchError(s))},_onValidateCallbackFailure:function(e,t,n,r){var i=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,i,n,r)},_onValidateCallbackSuccess:function(e,t,n,r){var i=this,s=t+1,o=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],o).then(function(){i._upload(e[t].id,n,r),i._maybeProcessNextItemAfterOnValidateCallback(!0,e,s,n,r)},function(){i._maybeProcessNextItemAfterOnValidateCallback(!1,e,s,n,r)})},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var r=this._getValidationDescriptors(e),i=this._getButtonId(e[0].file),s=this._getButton(i);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,s),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,s),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,t=this._options.session;qq.Session&&this._options.session.endpoint!=null&&(this._session||(qq.extend(t,this._options.cors),t.log=qq.bind(this.log,this),t.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(t)),setTimeout(function(){e._session.refresh().then(function(t,n){e._options.callbacks.onSessionRequestComplete(t,!0,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,!1,n)})},0))},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e,t,n){var r=this._uploadData.retrieve({id:e});if(!this._preventRetries[e]&&this._options.retry.enableAuto&&r.status!==qq.status.PAUSED){this._autoRetries[e]===undefined&&(this._autoRetries[e]=0);if(this._autoRetries[e]<this._options.retry.maxAutoAttempts)return this._autoRetries[e]+=1,!0}return!1},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var t;qq.supportedFeatures.ajaxUploading?t=this._handler.getFile(e).qqButtonId:t=this._getButtonId(this._handler.getInput(e)),t&&(this._buttonIdsForFileIds[e]=t)},_upload:function(e,t,n){var r=this.getName(e);t&&this.setParams(t,e),n&&this.setEndpoint(n,e),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,r),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,r),onFailure:qq.bind(this._fileOrBlobRejected,this,e,r),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,qq.status.QUEUED)},_validateFileOrBlobData:function(e,t){var n=this,r=function(){return e.file instanceof qq.BlobProxy?e.file.referenceBlob:e.file}(),i=t.name,s=t.size,o=this._getButtonId(e.file),u=this._getValidationBase(o),a=new qq.Promise;return a.then(function(){},function(){n._fileOrBlobRejected(e.id,i)}),qq.isFileOrInput(r)&&!this._isAllowedExtension(u.allowedExtensions,i)?(this._itemError("typeError",i,r),a.failure()):s===0?(this._itemError("emptyError",i,r),a.failure()):s>0&&u.sizeLimit&&s>u.sizeLimit?(this._itemError("sizeError",i,r),a.failure()):s>0&&s<u.minSizeLimit?(this._itemError("minSizeError",i,r),a.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(r)?(new qq.ImageValidation(r,qq.bind(n.log,n))).validate(u.image).then(a.success,function(e){n._itemError(e+"ImageError",i,r),a.failure()}):a.success(),a)},_wrapCallbacks:function(){var e,t,n;e=this,t=function(t,n,r){var i;try{return n.apply(e,r)}catch(s){i=s.message||s.toString(),e.log("Caught exception in '"+t+"' callback - "+i,"error")}};for(n in this._options.callbacks)(function(){var r,i;r=n,i=e._options.callbacks[r],e._options.callbacks[r]=function(){return t(r,i,arguments)}})()}}}(),function(){"use strict";qq.FineUploaderBasic=function(e){var t=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0}},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,r){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,r){},onResume:function(e,t,n){},onProgress:function(e,t,n,r){},onTotalProgress:function(e,t){},onError:function(e,t,n,r){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){return e!==undefined&&e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-14)),e},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!0}},qq.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(e){var n=t._uploadData.retrieve({id:e});return n&&n.size||0})),this._currentItemLimit=this._options.validation.itemLimit},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(e){"use strict";function o(){return qq.indexOf(["GET","POST","HEAD"],s.method)>=0}function u(e){var t=!1;return qq.each(t,function(e,n){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],n)<0)return t=!0,!1}),t}function a(e){return s.cors.expected&&e.withCredentials===undefined}function f(){var e;if(window.XMLHttpRequest||window.ActiveXObject)e=qq.createXhrInstance(),e.withCredentials===undefined&&(e=new XDomainRequest);return e}function l(e,t){var n=i[e].xhr;return n||(t?n=t:s.cors.expected?n=f():n=qq.createXhrInstance(),i[e].xhr=n),n}function c(e){var t=qq.indexOf(r,e),n=s.maxConnections,o;delete i[e],r.splice(t,1),r.length>=n&&t<n&&(o=r[n-1],d(o))}function h(e,n){var r=l(e),i=s.method,o=n===!0;c(e),o?t(i+" request for "+e+" has failed","error"):!a(r)&&!E(r.status)&&(o=!0,t(i+" request for "+e+" has failed - response code "+r.status,"error")),s.onComplete(e,r,o)}function p(e){var t=i[e].additionalParams,n=s.mandatedParams,r;return s.paramsStore.get&&(r=s.paramsStore.get(e)),t&&qq.each(t,function(e,t){r=r||{},r[e]=t}),n&&qq.each(n,function(e,t){r=r||{},r[e]=t}),r}function d(e,r){var o=l(e,r),u=s.method,f=p(e),c=i[e].payload,h;return s.onSend(e),h=v(e,f),a(o)?(o.onload=y(e),o.onerror=b(e)):o.onreadystatechange=m(e),g(e),o.open(u,h,!0),s.cors.expected&&s.cors.sendCredentials&&!a(o)&&(o.withCredentials=!0),w(e),t("Sending "+u+" request for "+e),c?o.send(c):n||!f?o.send():f&&s.contentType&&s.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?o.send(qq.obj2url(f,"")):f&&s.contentType&&s.contentType.toLowerCase().indexOf("application/json")>=0?o.send(JSON.stringify(f)):o.send(f),o}function v(e,t){var r=s.endpointStore.get(e),o=i[e].addToPath;return o!=undefined&&(r+="/"+o),n&&t?qq.obj2url(t,r):r}function m(e){return function(){l(e).readyState===4&&h(e)}}function g(e){var t=s.onProgress;t&&(l(e).upload.onprogress=function(n){n.lengthComputable&&t(e,n.loaded,n.total)})}function y(e){return function(){h(e)}}function b(e){return function(){h(e,!0)}}function w(e){var t=l(e),n=s.customHeaders,r=i[e].additionalHeaders||{},f=s.method,c={};a(t)||(s.acceptHeader&&t.setRequestHeader("Accept",s.acceptHeader),s.allowXRequestedWithAndCacheControl&&(!s.cors.expected||!o()||u(n))&&(t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Cache-Control","no-cache")),s.contentType&&(f==="POST"||f==="PUT")&&t.setRequestHeader("Content-Type",s.contentType),qq.extend(c,qq.isFunction(n)?n(e):n),qq.extend(c,r),qq.each(c,function(e,n){t.setRequestHeader(e,n)}))}function E(e){return qq.indexOf(s.successfulResponseCodes[s.method],e)>=0}function S(e,t,n,o,u,a){i[e]={addToPath:n,additionalParams:o,additionalHeaders:u,payload:a};var f=r.push(e);if(f<=s.maxConnections)return d(e,t)}var t,n,r=[],i={},s={acceptHeader:null,validMethods:["POST"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};qq.extend(s,e),t=s.log;if(qq.indexOf(s.validMethods,s.method)<0)throw new Error("'"+s.method+"' is not a supported method for this type of request!");n=s.method==="GET"||s.method==="DELETE",qq.extend(this,{initTransport:function(e){var t,n,r,i,o;return{withPath:function(e){return t=e,this},withParams:function(e){return n=e,this},withHeaders:function(e){return r=e,this},withPayload:function(e){return i=e,this},withCacheBuster:function(){return o=!0,this},send:function(u){return o&&qq.indexOf(["GET","DELETE"],s.method)>=0&&(n.qqtimestamp=(new Date).getTime()),S(e,u,t,n,r,i)}}},canceled:function(e){c(e)}})},qq.UploadHandler=function(e){"use strict";var t=e.proxy,n={},r=t.onCancel,i=t.getName;qq.extend(this,{add:function(e,t){n[e]=t,n[e].temp={}},cancel:function(e){var t=this,s=new qq.Promise,o=r(e,i(e),s);o.then(function(){t.isValid(e)&&(n[e].canceled=!0,t.expunge(e)),s.success()})},expunge:function(e){delete n[e]},getThirdPartyFileId:function(e){return n[e].key},isValid:function(e){return n[e]!==undefined},reset:function(){n={}},_getFileState:function(e){return n[e]},_setThirdPartyFileId:function(e,t){n[e].key=t},_wasCanceled:function(e){return!!n[e].canceled}})},qq.UploadHandlerController=function(e,t){"use strict";var n=this,r=!1,i=!1,s,o,u,a,f={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,n,r){},onComplete:function(e,t,n,r){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,r){},onAutoRetry:function(e,t,n,r){},onResume:function(e,t,n){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){}},l={done:function(e,t,n,r){var i=a._getChunkData(e,t);a._getFileState(e).attemptingResume=!1,delete a._getFileState(e).temp.chunkProgress[t],a._getFileState(e).loaded+=i.size,f.onUploadChunkSuccess(e,a._getChunkDataForCallback(i),n,r)},finalize:function(e){var t=f.getSize(e),n=f.getName(e);u("All chunks have been uploaded for "+e+" - finalizing...."),a.finalizeChunks(e).then(function(r,i){u("Finalize successful for "+e);var s=p.normalizeResponse(r,!0);f.onProgress(e,n,t,t),a._maybeDeletePersistedChunkData(e),p.cleanup(e,s,i)},function(t,r){var i=p.normalizeResponse(t,!1);u("Problem finalizing chunks for file ID "+e+" - "+i.error,"error"),i.reset&&l.reset(e),f.onAutoRetry(e,n,i,r)||p.cleanup(e,i,r)})},hasMoreParts:function(e){return!!a._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=a._getFileState(e).chunking.remaining.shift();return t>=a._getTotalChunks(e)&&(t=null),t},reset:function(e){u("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),a._maybeDeletePersistedChunkData(e),a.reevaluateChunking(e),a._getFileState(e).loaded=0},sendNext:function(e){var t=f.getSize(e),n=f.getName(e),r=l.nextPart(e),s=a._getChunkData(e,r),o=a._getFileState(e).attemptingResume,h=a._getFileState(e).chunking.inProgress||[];a._getFileState(e).loaded==null&&(a._getFileState(e).loaded=0),o&&f.onResume(e,n,s)===!1&&(l.reset(e),r=l.nextPart(e),s=a._getChunkData(e,r),o=!1),r==null&&h.length===0?l.finalize(e):(u("Sending chunked upload request for item "+e+": bytes "+(s.start+1)+"-"+s.end+" of "+t),f.onUploadChunk(e,n,a._getChunkDataForCallback(s)),h.push(r),a._getFileState(e).chunking.inProgress=h,i&&c.open(e,r),i&&c.available()&&a._getFileState(e).chunking.remaining.length&&l.sendNext(e),a.uploadChunk(e,r,o).then(function(n,i){u("Chunked upload request succeeded for "+e+", chunk "+r),a.clearCachedChunk(e,r);var s=a._getFileState(e).chunking.inProgress||[],o=p.normalizeResponse(n,!0),f=qq.indexOf(s,r);u(qq.format("Chunk {} for file {} uploaded successfully.",r,e)),l.done(e,r,o,i),f>=0&&s.splice(f,1),a._maybePersistChunkedState(e),!l.hasMoreParts(e)&&s.length===0?l.finalize(e):l.hasMoreParts(e)&&l.sendNext(e)},function(s,o){u("Chunked upload request failed for "+e+", chunk "+r),a.clearCachedChunk(e,r);var h=p.normalizeResponse(s,!1),d;h.reset?l.reset(e):(d=qq.indexOf(a._getFileState(e).chunking.inProgress,r),d>=0&&(a._getFileState(e).chunking.inProgress.splice(d,1),a._getFileState(e).chunking.remaining.unshift(r))),a._getFileState(e).temp.ignoreFailure||(i&&(a._getFileState(e).temp.ignoreFailure=!0,qq.each(a._getXhrs(e),function(e,t){t.abort()}),a.moveInProgressToRemaining(e),c.free(e,!0)),f.onAutoRetry(e,n,h,o)||p.cleanup(e,h,o))}).done(function(){a.clearXhr(e,r)}))}},c={_open:[],_openChunks:{},_waiting:[],available:function(){var e=f.maxConnections,t=0,n=0;return qq.each(c._openChunks,function(e,r){t++,n+=r.length}),e-(c._open.length-t+n)},free:function(e,t){var n=!t,r=qq.indexOf(c._waiting,e),i=qq.indexOf(c._open,e),s;delete c._openChunks[e],p.getProxyOrBlob(e)instanceof qq.BlobProxy&&(u("Generated blob upload has ended for "+e+", disposing generated blob."),delete a._getFileState(e).file),r>=0?c._waiting.splice(r,1):n&&i>=0&&(c._open.splice(i,1),s=c._waiting.shift(),s>=0&&(c._open.push(s),p.start(s)))},getWaitingOrConnected:function(){var e=[];return qq.each(c._openChunks,function(t,n){n&&n.length&&e.push(parseInt(t))}),qq.each(c._open,function(t,n){c._openChunks[n]||e.push(parseInt(n))}),e=e.concat(c._waiting),e},isUsingConnection:function(e){return qq.indexOf(c._open,e)>=0},open:function(e,t){return t==null&&c._waiting.push(e),c.available()?(t==null?(c._waiting.pop(),c._open.push(e)):function(){var n=c._openChunks[e]||[];n.push(t),c._openChunks[e]=n}(),!0):!1},reset:function(){c._waiting=[],c._open=[]}},h={send:function(e,t){a._getFileState(e).loaded=0,u("Sending simple upload request for "+e),a.uploadFile(e).then(function(n,r){u("Simple upload request succeeded for "+e);var i=p.normalizeResponse(n,!0),s=f.getSize(e);f.onProgress(e,t,s,s),p.maybeNewUuid(e,i),p.cleanup(e,i,r)},function(n,r){u("Simple upload request failed for "+e);var i=p.normalizeResponse(n,!1);f.onAutoRetry(e,t,i,r)||p.cleanup(e,i,r)})}},p={cancel:function(e){u("Cancelling "+e),f.paramsStore.remove(e),c.free(e)},cleanup:function(e,t,n){var r=f.getName(e);f.onComplete(e,r,t,n),a._getFileState(e)&&a._clearXhrs&&a._clearXhrs(e),c.free(e)},getProxyOrBlob:function(e){return a.getProxy&&a.getProxy(e)||a.getFile&&a.getFile(e)},initHandler:function(){var e=t?qq[t]:qq.traditional,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";a=new e[n+"UploadHandler"](f,{getDataByUuid:f.getDataByUuid,getName:f.getName,getSize:f.getSize,getUuid:f.getUuid,log:u,onCancel:f.onCancel,onProgress:f.onProgress,onUuidChanged:f.onUuidChanged}),a._removeExpiredChunkingRecords&&a._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return f.isQueued(e)},maybeDefer:function(e,t){return t&&!a.getFile(e)&&t instanceof qq.BlobProxy?(f.onUploadPrep(e),u("Attempting to generate a blob on-demand for "+e),t.create().then(function(t){u("Generated an on-demand blob for "+e),a.updateBlob(e,t),f.setSize(e,t.size),a.reevaluateChunking(e),p.maybeSendDeferredFiles(e)},function(t){var n={};t&&(n.error=t),u(qq.format("Failed to generate blob for ID {}.  Error message: {}.",e,t),"error"),f.onComplete(e,f.getName(e),qq.extend(n,o),null),p.maybeSendDeferredFiles(e),c.free(e)}),!1):p.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var t=f.getIdsInProxyGroup(e),n=!1;return t&&t.length?(u("Maybe ready to upload proxy group file "+e),qq.each(t,function(t,r){if(p.isDeferredEligibleForUpload(r)&&!!a.getFile(r))n=r===e,p.now(r);else if(p.isDeferredEligibleForUpload(r))return!1})):(n=!0,p.now(e)),n},maybeNewUuid:function(e,t){t.newUuid!==undefined&&f.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,t){var n=e;return qq.isObject(e)||(n={},qq.isString(e)&&!t&&(n.error=e)),n.success=t,n},now:function(e){var t=f.getName(e);if(!n.isValid(e))throw new qq.Error(e+" is not a valid file ID to upload!");f.onUpload(e,t),r&&a._shouldChunkThisFile(e)?l.sendNext(e):h.send(e,t)},start:function(e){var t=p.getProxyOrBlob(e);return t?p.maybeDefer(e,t):(p.now(e),!0)}};qq.extend(this,{add:function(e,t){a.add.apply(this,arguments)},upload:function(e){return c.open(e)?p.start(e):!1},retry:function(e){return i&&(a._getFileState(e).temp.ignoreFailure=!1),c.isUsingConnection(e)?p.start(e):n.upload(e)},cancel:function(e){var t=a.cancel(e);qq.isGenericPromise(t)?t.then(function(){p.cancel(e)}):t!==!1&&p.cancel(e)},cancelAll:function(){var e=c.getWaitingOrConnected(),t;if(e.length)for(t=e.length-1;t>=0;t--)n.cancel(e[t]);c.reset()},getFile:function(e){return a.getProxy&&a.getProxy(e)?a.getProxy(e).referenceBlob:a.getFile&&a.getFile(e)},isProxied:function(e){return!!a.getProxy&&!!a.getProxy(e)},getInput:function(e){if(a.getInput)return a.getInput(e)},reset:function(){u("Resetting upload handler"),n.cancelAll(),c.reset(),a.reset()},expunge:function(e){if(n.isValid(e))return a.expunge(e)},isValid:function(e){return a.isValid(e)},getResumableFilesData:function(){return a.getResumableFilesData?a.getResumableFilesData():[]},getThirdPartyFileId:function(e){if(n.isValid(e))return a.getThirdPartyFileId(e)},pause:function(e){return n.isResumable(e)&&a.pause&&n.isValid(e)&&a.pause(e)?(c.free(e),a.moveInProgressToRemaining(e),!0):!1},isResumable:function(e){return!!a.isResumable&&a.isResumable(e)}}),qq.extend(f,e),u=f.log,r=f.chunking.enabled&&qq.supportedFeatures.chunking,i=r&&f.chunking.concurrent.enabled,o=function(){var e={};return e[f.preventRetryParam]=!0,e}(),p.initHandler()},qq.FormUploadHandler=function(e){"use strict";function p(e){delete o[e],a&&(clearTimeout(u[e]),delete u[e],h.stopReceivingMessages(e));var t=document.getElementById(n._getIframeName(e));t&&(t.setAttribute("src","javascript:false;"),qq(t).remove())}function d(e){return e.split("_")[0]}function v(e){var t=qq.toElement("<iframe src='javascript:false;' name='"+e+"' />");return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t}function m(e,t){var r=e.id,i=d(r),a=l(i);s[a]=t,o[i]=qq(e).attach("load",function(){n.getInput(i)&&(c("Received iframe load event for CORS upload request (iframe name "+r+")"),u[r]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+r;c(e,"error"),t({error:e})},1e3))}),h.receiveMessage(r,function(e){c("Received the following window message: '"+e+"'");var t=d(r),i=n._parseJsonResponse(e),o=i.uuid,a;o&&s[o]?(c("Handling response for iframe name "+r),clearTimeout(u[r]),delete u[r],n._detachLoadEvent(r),a=s[o],delete s[o],h.stopReceivingMessages(r),a(i)):o||c("'"+e+"' does not contain a UUID - ignoring.")})}var t=e.options,n=this,r=e.proxy,i=qq.getUniqueId(),s={},o={},u={},a=t.isCors,f=t.inputName,l=r.getUuid,c=r.log,h=new qq.WindowReceiveMessage({log:c});qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(t,n){e.add(t,{input:n}),n.setAttribute("name",f),n.parentNode&&qq(n).remove()},expunge:function(t){p(t),e.expunge(t)},isValid:function(t){return e.isValid(t)&&n._getFileState(t).input!==undefined}}}),qq.extend(this,{getInput:function(e){return n._getFileState(e).input},_attachLoadEvent:function(e,t){var n;a?m(e,t):o[e.id]=qq(e).attach("load",function(){c("Received response for "+e.id);if(!e.parentNode)return;try{if(e.contentDocument&&e.contentDocument.body&&e.contentDocument.body.innerHTML=="false")return}catch(r){c("Error when attempting to access iframe during handling of upload response ("+r.message+")","error"),n={success:!1}}t(n)})},_createIframe:function(e){var t=n._getIframeName(e);return v(t)},_detachLoadEvent:function(e){o[e]!==undefined&&(o[e](),delete o[e])},_getIframeName:function(e){return e+"_"+i},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,r=e.params,i=e.paramsInBody,s=e.targetName,o=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),u=n;return i?qq.obj2Inputs(r,o):u=qq.obj2url(r,n),o.setAttribute("action",u),o.setAttribute("target",s),o.style.display="none",document.body.appendChild(o),o},_parseJsonResponse:function(e){var t={};try{t=qq.parseJson(e)}catch(n){c("Error when attempting to parse iframe upload response ("+n.message+")","error")}return t}})},qq.XhrUploadHandler=function(e){"use strict";function m(e){qq.each(t._getXhrs(e),function(n,r){var i=t._getAjaxRequester(e,n);r.onreadystatechange=null,r.upload.onprogress=null,r.abort(),i&&i.canceled&&i.canceled(e)})}var t=this,n=e.options.namespace,r=e.proxy,i=e.options.chunking,s=e.options.resume,o=i&&e.options.chunking.enabled&&qq.supportedFeatures.chunking,u=s&&e.options
.resume.enabled&&o&&qq.supportedFeatures.resume,a=r.getName,f=r.getSize,l=r.getUuid,c=r.getEndpoint,h=r.getDataByUuid,p=r.onUuidChanged,d=r.onProgress,v=r.log;qq.extend(this,new qq.UploadHandler(e)),qq.override(this,function(e){return{add:function(n,r){if(qq.isFile(r)||qq.isBlob(r))e.add(n,{file:r});else{if(!(r instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(n,{proxy:r})}t._initTempState(n),u&&t._maybePrepareForResume(n)},expunge:function(n){m(n),t._maybeDeletePersistedChunkData(n),t._clearXhrs(n),e.expunge(n)}}}),qq.extend(this,{clearCachedChunk:function(e,n){delete t._getFileState(e).temp.cachedChunks[n]},clearXhr:function(e,n){var r=t._getFileState(e).temp;r.xhrs&&delete r.xhrs[n],r.ajaxRequesters&&delete r.ajaxRequesters[n]},finalizeChunks:function(e,n){var r=t._getTotalChunks(e)-1,i=t._getXhr(e,r);return n?(new qq.Promise).success(n(i),i):(new qq.Promise).success({},i)},getFile:function(e){return t.isValid(e)&&t._getFileState(e).file},getProxy:function(e){return t.isValid(e)&&t._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return t._iterateResumeRecords(function(n,r){t.moveInProgressToRemaining(null,r.chunking.inProgress,r.chunking.remaining);var i={name:r.name,remaining:r.chunking.remaining,size:r.size,uuid:r.uuid};r.key&&(i.key=r.key),e.push(i)}),e},isResumable:function(e){return!!i&&t.isValid(e)&&!t._getFileState(e).notResumable},moveInProgressToRemaining:function(e,n,r){var i=n||t._getFileState(e).chunking.inProgress,s=r||t._getFileState(e).chunking.remaining;i&&(i.reverse(),qq.each(i,function(e,t){s.unshift(t)}),i.length=0)},pause:function(e){if(t.isValid(e))return v(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,a(e))),t._getFileState(e).paused=!0,m(e),!0},reevaluateChunking:function(e){if(i&&t.isValid(e)){var n=t._getFileState(e),r,s;delete n.chunking,n.chunking={},r=t._getTotalChunks(e);if(r>1||i.mandatory){n.chunking.enabled=!0,n.chunking.parts=r,n.chunking.remaining=[];for(s=0;s<r;s++)n.chunking.remaining.push(s);t._initTempState(e)}else n.chunking.enabled=!1}},updateBlob:function(e,n){t.isValid(e)&&(t._getFileState(e).file=n)},_clearXhrs:function(e){var n=t._getFileState(e).temp;qq.each(n.ajaxRequesters,function(e){delete n.ajaxRequesters[e]}),qq.each(n.xhrs,function(e){delete n.xhrs[e]})},_createXhr:function(e,n){return t._registerXhr(e,n,qq.createXhrInstance())},_getAjaxRequester:function(e,n){var r=n==null?-1:n;return t._getFileState(e).temp.ajaxRequesters[r]},_getChunkData:function(e,n){var r=i.partSize,s=f(e),o=t.getFile(e),u=r*n,a=u+r>=s?s:u+r,l=t._getTotalChunks(e),c=this._getFileState(e).temp.cachedChunks,h=c[n]||qq.sliceBlob(o,u,a);return c[n]=h,{part:n,start:u,end:a,count:l,blob:h,size:a-u}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var t="5.0",r=a(e),s=f(e),o=i.partSize,u=c(e);return qq.format("qq{}resume{}-{}-{}-{}-{}",n,t,r,s,o,u)},_getMimeType:function(e){return t.getFile(e).type},_getPersistableData:function(e){return t._getFileState(e).chunking},_getTotalChunks:function(e){if(i){var t=f(e),n=i.partSize;return Math.ceil(t/n)}},_getXhr:function(e,n){var r=n==null?-1:n;return t._getFileState(e).temp.xhrs[r]},_getXhrs:function(e){return t._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){u&&qq.each(localStorage,function(t,r){if(t.indexOf(qq.format("qq{}resume-",n))===0){var i=JSON.parse(r);e(t,i)}})},_initTempState:function(e){t._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){t._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var n;if(u&&t.isResumable(e)){n=t._getLocalStorageId(e);if(n&&localStorage.getItem(n))return localStorage.removeItem(n),!0}return!1},_maybePrepareForResume:function(e){var n=t._getFileState(e),r,i;u&&n.key===undefined&&(r=t._getLocalStorageId(e),i=localStorage.getItem(r),i&&(i=JSON.parse(i),h(i.uuid)?t._markNotResumable(e):(v(qq.format("Identified file with ID {} and name of {} as resumable.",e,a(e))),p(e,i.uuid),n.key=i.key,n.chunking=i.chunking,n.loaded=i.loaded,n.attemptingResume=!0,t.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var n=t._getFileState(e),r,i;u&&t.isResumable(e)&&(r=t._getLocalStorageId(e),i={name:a(e),size:f(e),uuid:l(e),key:n.key,chunking:n.chunking,loaded:n.loaded,lastUpdated:Date.now()},localStorage.setItem(r,JSON.stringify(i)))},_registerProgressHandler:function(e,n,r){var i=t._getXhr(e,n),s=a(e),o={simple:function(t,n){var r=f(e);t===n?d(e,s,r,r):d(e,s,t>=r?r-1:t,r)},chunked:function(i,o){var u=t._getFileState(e).temp.chunkProgress,a=t._getFileState(e).loaded,l=i,c=o,h=f(e),p=l-(c-r),v=a;u[n]=p,qq.each(u,function(e,t){v+=t}),d(e,s,v,h)}};i.upload.onprogress=function(e){if(e.lengthComputable){var t=r==null?"simple":"chunked";o[t](e.loaded,e.total)}}},_registerXhr:function(e,n,r,i){var s=n==null?-1:n,o=t._getFileState(e).temp;return o.xhrs=o.xhrs||{},o.ajaxRequesters=o.ajaxRequesters||{},o.xhrs[s]=r,i&&(o.ajaxRequesters[s]=i),r},_removeExpiredChunkingRecords:function(){var e=s.recordsExpireIn;t._iterateResumeRecords(function(t,n){var r=new Date(n.lastUpdated);r.setDate(r.getDate()+e),r.getTime()<=Date.now()&&(v("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var n=t._getFileState(e);return n.chunking||t.reevaluateChunking(e),n.chunking.enabled}})},qq.WindowReceiveMessage=function(e){"use strict";var t={log:function(e,t){}},n={};qq.extend(t,e),qq.extend(this,{receiveMessage:function(e,t){var r=function(e){t(e.data)};window.postMessage?n[e]=qq(window).attach("message",r):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];t&&t()}}})},function(){"use strict";qq.uiPublicApi={clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){if(this._dnd)return this._dnd.removeDropzone(e)},getItemByFileId:function(e){return this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}},qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,r=n.getDropZone();return r&&t.push(r),new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(t,r){n.hideDropProcessing(),qq.each(t,function(e,t){t.qqDropTarget=r}),t.length&&e.addFiles(t,null,null)},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){qq(e._templating.getFileContainer(t)).removeClass(e._classes.retryable),e._templating.hideRetry(t),e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,n){e.setName(t,n)},onEditingStatusChange:function(e,n){var r=qq(t.getEditInput(e)),i=qq(t.getFileContainer(e));n?(r.addClass("qq-editing"),t.hideFilename(e),t.hideEditIcon(e)):(r.removeClass("qq-editing"),t.showFilename(e),t.showEditIcon(e)),i.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e))},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:n.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,n,r){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,n,r),Math.round(n/r*100)===100?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,n,r)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,t,n,r){function a(t){if(!o)return;s.setStatusText(e),qq(o).removeClass(u._classes.retrying),s.hideProgress(e),(!u._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&s.hideCancel(e),s.hideSpinner(e),t.success?u._markFileAsSuccessful(e):(qq(o).addClass(u._classes.fail),s.isRetryPossible()&&!u._preventRetries[e]&&(qq(o).addClass(u._classes.retryable),s.showRetry(e)),u._controlFailureTextDisplay(e,t))}var i=this._parent.prototype._onComplete.apply(this,arguments),s=this._templating,o=s.getFileContainer(e),u=this;return i instanceof qq.Promise?i.done(function(e){a(e)}):a(n),i},_markFileAsSuccessful:function(e){var t=this._templating;this._isDeletePossible()&&t.showDeleteButton(e),qq(t.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),this._getNotFinished()===0&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var t,n,r;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(t=this._autoRetries[e],n=this._options.retry.maxAutoAttempts,r=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t),r=r.replace(/\{maxAuto\}/g,n),this._templating.setStatusText(e,r),qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),n?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,t,n){var r=this.getName(e),i=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,r),t=this.getUuid(e),s=arguments,o=this,u;u=this._options.showConfirm(i),qq.isGenericPromise(u)?u.then(function(){o._sendDeleteRequest.apply(o,s)}):u!==!1&&o._sendDeleteRequest.apply(o,s)},_addToList:function(e,t,n){var r,i=0,s=this._handler.isProxied(e)&&this._options.scaling.hideScaled,o;if(s)return;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(i=this._filesInBatchAddedToUi-1),r={index:i});if(!n){this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel();if(!this._options.multiple){o=this.getUploads({id:e}),this._handledProxyGroup=this._handledProxyGroup||o.proxyGroupId;if(o.proxyGroupId!==this._handledProxyGroup||!o.proxyGroupId)this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null}}this._templating.addFile(e,this._options.formatFileName(t),r),n?this._thumbnailUrls[e]&&this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0):this._templating.generatePreview(e,this.getFile(e)),this._filesInBatchAddedToUi+=1,(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(e)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,n){var r=this.getSize(e),i=this._formatSize(r);r>=0&&(t!==undefined&&n!==undefined&&(i=this._formatProgress(t,n)),this._templating.updateSize(e,i))},_formatProgress:function(e,t){function r(e,t){n=n.replace(e,t)}var n=this._options.text.formatProgress;return r("{percent}",Math.round(e/t*100)),r("{total_size}",this._formatSize(t)),n},_controlFailureTextDisplay:function(e,t){var n,r,i,s,o;n=this._options.failedUploadTextDisplay.mode,r=this._options.failedUploadTextDisplay.maxChars,i=this._options.failedUploadTextDisplay.responseProperty,n==="custom"?(s=t[i],s?s.length>r&&(o=s.substring(0,r)+"..."):s=this._options.text.failUpload,this._templating.setStatusText(e,o||s),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,s)):n==="default"?this._templating.setStatusText(e,this._options.text.failUpload):n!=="none"&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&this._templating.showCancel(e)},_itemError:function(e,t,n){var r=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(r)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e];this._templating.updateThumbnail(e,t)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(t,this.getName(t),!0),this._templating.hideSpinner(t),this._templating.hideCancel(t),this._markFileAsSuccessful(t),t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))}}}(),qq.FineUploader=function(e,t){"use strict";this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(e){setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return window.confirm(e)},showPrompt:function(e,t){return window.prompt(e,t)}},!0),qq.extend(this._options,e,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(e){"use strict";var t="qq-file-id",n="qq-file-id-",r="qq-max-size",i="qq-server-scale",s="qq-hide-dropzone",o=!1,u=0,a=!1,f=[],l=-1,c={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},h={button:"qq-upload-button-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},p={},d=new qq.Promise,v=new qq.Promise,m,g,y,b,w,E,S,x,T=function(){var e=c.placeholders.thumbnailNotAvailable,t=c.placeholders.waitingForThumbnail,n={maxSize:l,scale:x};S&&(e?c.imageGenerator.generate(e,new Image,n).then(function(e){d.success(e)},function(){d.failure(),m("Problem loading 'not available' placeholder image at "+e,"error")}):d.failure(),t?c.imageGenerator.generate(t,new Image,n).then(function(e){v.success(e)},function(){v.failure(),m("Problem loading 'waiting for thumbnail' placeholder image at "+t,"error")}):v.failure())},N=function(e){var t=new qq.Promise;return v.then(function(n){z(n,e),e.src?t.success():(e.src=n.src,e.onload=function(){e.onload=null,Q(e),t.success()})},function(){U(e),t.success()}),t},C=function(e,t,n){var r=R(e);return m("Generating new thumbnail for "+e),t.qqThumbnailId=e,c.imageGenerator.generate(t,r,n).then(function(){u++,Q(r),p[e].success()},function(){p[e].failure(),c.placeholders.waitUntilUpdate||W(e,r)})},k=function(){if(f.length){a=!0;var e=f.shift();e.update?J(e):$(e)}else a=!1},L=function(e){return q(D(e),h.cancel)},A=function(e){return q(D(e),h.continueButton)},O=function(e){return q(D(e),h.deleteButton)},M=function(){return q(w,h.dropProcessing)},_=function(e){return q(D(e),h.editNameIcon)},D=function(e){return qq(E).getByClass(n+e)[0]},P=function(e){return q(D(e),h.file)},H=function(e){return q(D(e),h.pause)},B=function(e){return e==null?q(w,h.totalProgressBarContainer)||q(w,h.totalProgressBar):q(D(e),h.progressBarContainer)||q(D(e),h.progressBar)},j=function(e){return q(D(e),h.retry)},F=function(e){return q(D(e),h.size)},I=function(e){return q(D(e),h.spinner)},q=function(e,t){return e&&qq(e).getByClass(t)[0]},R=function(e){return S&&q(D(e),h.thumbnail)},U=function(e){e&&qq(e).addClass(c.classes.hide)},z=function(e,t){var n=e.style.maxWidth,r=e.style.maxHeight;r&&n&&!t.style.maxWidth&&!t.style.maxHeight&&qq(t).css({maxWidth:n,maxHeight:r})},W=function(e,t){var n=p[e]||(new qq.Promise).failure(),r=new qq.Promise;return d.then(function(e){n.then(function(){r.success()},function(){z(e,t),t.onload=function(){t.onload=null,r.success()},t.src=e.src,Q(t)})}),r},X=function(){var e,t,n,o,u,a,f,p,d;m("Parsing template");if(c.templateIdOrEl==null)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(c.templateIdOrEl)){e=document.getElementById(c.templateIdOrEl);if(e===null)throw new Error(qq.format("Cannot find template script at ID '{}'!",c.templateIdOrEl));t=e.innerHTML}else{if(c.templateIdOrEl.innerHTML===undefined)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");t=c.templateIdOrEl.innerHTML}t=qq.trimStr(t),o=document.createElement("div"),o.appendChild(qq.toElement(t)),c.button&&(a=qq(o).getByClass(h.button)[0],a&&qq(a).remove());if(!qq.DragAndDrop||!qq.supportedFeatures.fileDrop)d=qq(o).getByClass(h.dropProcessing)[0],d&&qq(d).remove();f=qq(o).getByClass(h.drop)[0],f&&!qq.DragAndDrop&&(m("DnD module unavailable.","info"),qq(f).remove()),f&&!qq.supportedFeatures.fileDrop&&qq(f).hasAttribute(s)&&qq(f).css({display:"none"}),p=qq(o).getByClass(h.thumbnail)[0],S?p&&(l=parseInt(p.getAttribute(r)),l=l>0?l:null,x=qq(p).hasAttribute(i)):p&&qq(p).remove(),S=S&&p,g=qq(o).getByClass(h.editFilenameInput).length>0,y=qq(o).getByClass(h.retry).length>0,n=qq(o).getByClass(h.list)[0];if(n==null)throw new Error("Could not find the file list container in the template!");return u=n.innerHTML,n.innerHTML="",m("Template parsing complete"),{template:qq.trimStr(o.innerHTML),fileTemplate:qq.trimStr(u)}},V=function(e,t){var n=E,r=n.firstChild;t>0&&(r=qq(n).children()[t].nextSibling),n.insertBefore(e,r)},$=function(e){var t=e.id,n=e.optFileOrBlob,r=n&&n.qqThumbnailId,i=R(t),s={maxSize:l,scale:!0,orient:!0};qq.supportedFeatures.imagePreviews?i&&(c.limits.maxThumbs&&c.limits.maxThumbs<=u?(W(t,i),k()):N(i).done(function(){p[t]=new qq.Promise,p[t].done(function(){setTimeout(k,c.limits.timeBetweenThumbs)}),r!=null?G(t,r):C(t,n,s)})):i&&(N(i),k())},J=function(e){var t=e.id,n=e.thumbnailUrl,r=e.showWaitingImg,i=R(t),s={maxSize:l,scale:x};if(i)if(n){if(!(c.limits.maxThumbs&&c.limits.maxThumbs<=u))return r&&N(i),c.imageGenerator.generate(n,i,s).then(function(){Q(i),u++,setTimeout(k,c.limits.timeBetweenThumbs)},function(){W(t,i),setTimeout(k,c.limits.timeBetweenThumbs)});W(t,i),k()}else W(t,i),k()},K=function(e,t){var n=B(e),r=e==null?h.totalProgressBar:h.progressBar;n&&!qq(n).hasClass(r)&&(n=qq(n).getByClass(r)[0]),n&&qq(n).css({width:t+"%"})},Q=function(e){e&&qq(e).removeClass(c.classes.hide)},G=function(e,t){var n=R(e),r=R(t);m(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",e,t,t)),p[t].then(function(){u++,p[e].success(),m(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",t,e)),n.src=r.src,Q(n)},function(){p[e].failure(),c.placeholders.waitUntilUpdate||W(e,n)})};qq.extend(c,e),m=c.log,qq.supportedFeatures.imagePreviews||(c.limits.timeBetweenThumbs=0,c.limits.maxThumbs=0),w=c.containerEl,S=c.imageGenerator!==undefined,b=X(),T(),qq.extend(this,{render:function(){m("Rendering template in DOM."),u=0,w.innerHTML=b.template,U(M()),this.hideTotalProgress(),E=c.fileContainerEl||q(w,h.list),m("Template rendering complete")},renderFailure:function(e){var t=qq.toElement(e);w.innerHTML="",w.appendChild(t)},reset:function(){this.render()},clearFiles:function(){E.innerHTML=""},disableCancel:function(){o=!0},addFile:function(e,r,i){var s=qq.toElement(b.fileTemplate),u=q(s,h.file),a;qq(s).addClass(n+e),u&&qq(u).setText(r),s.setAttribute(t,e),i?V(s,i.index):E.appendChild(s),U(B(e)),U(F(e)),U(O(e)),U(j(e)),U(H(e)),U(A(e)),o&&this.hideCancel(e),a=R(e),a&&!a.src&&v.then(function(e){a.src=e.src,e.style.maxHeight&&e.style.maxWidth&&qq(a).css({maxHeight:e.style.maxHeight,maxWidth:e.style.maxWidth}),Q(a)})},removeFile:function(e){qq(D(e)).remove()},getFileId:function(e){var n=e;if(n){while(n.getAttribute(t)==null)n=n.parentNode;return parseInt(n.getAttribute(t))}},getFileList:function(){return E},markFilenameEditable:function(e){var t=P(e);t&&qq(t).addClass(c.classes.editable)},updateFilename:function(e,t){var n=P(e);n&&qq(n).setText(t)},hideFilename:function(e){U(P(e))},showFilename:function(e){Q(P(e))},isFileName:function(e){return qq(e).hasClass(h.file)},getButton:function(){return c.button||q(w,h.button)},hideDropProcessing:function(){U(M())},showDropProcessing:function(){Q(M())},getDropZone:function(){return q(w,h.drop)},isEditFilenamePossible:function(){return g},hideRetry:function(e){U(j(e))},isRetryPossible:function(){return y},showRetry:function(e){Q(j(e))},getFileContainer:function(e){return D(e)},showEditIcon:function(e){var t=_(e);t&&qq(t).addClass(c.classes.editable)},hideEditIcon:function(e){var t=_(e);t&&qq(t).removeClass(c.classes.editable)},isEditIcon:function(e){return qq(e).hasClass(h.editNameIcon)},getEditInput:function(e){return q(D(e),h.editFilenameInput)},isEditInput:function(e){return qq(e).hasClass(h.editFilenameInput)},updateProgress:function(e,t,n){var r=B(e),i;r&&n>0&&(i=Math.round(t/n*100),i===100?U(r):Q(r),K(e,i))},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=B(e);t&&U(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){K(e,0),this.hideTotalProgress(e)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!o){var t=L(e);t&&qq(t).removeClass(c.classes.hide)}},hideCancel:function(e){U(L(e))},isCancel:function(e){return qq(e).hasClass(h.cancel)},allowPause:function(e){Q(H(e)),U(A(e))},uploadPaused:function(e){this.setStatusText(e,c.text.paused),this.allowContinueButton(e),U(I(e))},hidePause:function(e){U(H(e))},isPause:function(e){return qq(e).hasClass(h.pause)},isContinueButton:function(e){return qq(e).hasClass(h.continueButton)},allowContinueButton:function(e){Q(A(e)),U(H(e))},uploadContinued:function(e){this.setStatusText(e,""),this.allowPause(e),Q(I(e))},showDeleteButton:function(e){Q(O(e))},hideDeleteButton:function(e){U(O(e))},isDeleteButton:function(e){return qq(e).hasClass(h.deleteButton)},isRetry:function(e){return qq(e).hasClass(h.retry)},updateSize:function(e,t){var n=F(e);n&&(Q(n),qq(n).setText(t))},setStatusText:function(e,t){var n=q(D(e),h.statusText);n&&(t==null?qq(n).clearText():qq(n).setText(t))},hideSpinner:function(e){U(I(e))},showSpinner:function(e){Q(I(e))},generatePreview:function(e,t){f.push({id:e,optFileOrBlob:t}),!a&&k()},updateThumbnail:function(e,t,n){f.push({update:!0,id:e,thumbnailUrl:t,showWaitingImg:n}),!a&&k()}})},qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(e,t){"use strict";function o(e,t){var r,i,o;try{i=t.contentDocument||t.contentWindow.document,o=i.body.innerHTML,s("converting iframe's innerHTML to JSON"),s("innerHTML = "+o),o&&o.match(/^<pre/i)&&(o=i.body.firstChild.firstChild.nodeValue),r=n._parseJsonResponse(o)}catch(u){s("Error when attempting to parse form upload response ("+u.message+")","error"),r={success:!1}}return r}function u(t,s){var o=e.paramsStore.get(t),u=e.demoMode?"GET":"POST",a=e.endpointStore.get(t),f=r(t);return o[e.uuidName]=i(t),o[e.filenameParam]=f,n._initFormForUpload({method:u,endpoint:a,params:o,paramsInBody:e.paramsInBody,targetName:s.name})}var n=this,r=t.getName,i=t.getUuid,s=t.log;this.uploadFile=function(t){var r=n.getInput(t),i=n._createIframe(t),a=new qq.Promise,f;return f=u(t,i),f.appendChild(r),n._attachLoadEvent(i,function(r){s("iframe loaded");var u=r?r:o(t,i);n._detachLoadEvent(t),e.cors.expected||qq(i).remove(),u.success?a.success(u):a.failure(u)}),s("Sending upload request for "+t),f.submit(),qq(f).remove(),a},qq.extend
(this,new qq.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:r,getUuid:i,log:s}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(e,t){"use strict";var n=this,r=t.getName,i=t.getSize,s=t.getUuid,o=t.log,u=e.forceMultipart||e.paramsInBody,a=function(t,n,s){var o=i(t),a=r(t);n[e.chunking.paramNames.partIndex]=s.part,n[e.chunking.paramNames.partByteOffset]=s.start,n[e.chunking.paramNames.chunkSize]=s.size,n[e.chunking.paramNames.totalParts]=s.count,n[e.totalFileSizeName]=o,u&&(n[e.filenameParam]=a)},f=new qq.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,log:o}),l=function(e,t){var n=new qq.Promise;return t.onreadystatechange=function(){if(t.readyState===4){var r=p(e,t);r.success?n.success(r.response,t):n.failure(r.response,t)}},n},c=function(t){var o=e.paramsStore.get(t),u=r(t),a=i(t);return o[e.uuidName]=s(t),o[e.filenameParam]=u,o[e.totalFileSizeName]=a,o[e.chunking.paramNames.totalParts]=n._getTotalChunks(t),o},h=function(e,t){return e.status!==200||!t.success||t.reset},p=function(e,t){var n;return o("xhr - server response received for "+e),o("responseText = "+t.responseText),n=d(!0,t),{success:!h(t,n),response:n}},d=function(e,t){var n={};try{o(qq.format("Received response status {} with body: {}",t.status,t.responseText)),n=qq.parseJson(t.responseText)}catch(r){e&&o("Error when attempting to parse xhr response text ("+r.message+")","error")}return n},v=function(t){var r=new qq.Promise;return f.complete(t,n._createXhr(t),c(t),e.customHeaders.get(t)).then(function(e){r.success(d(!1,e),e)},function(e){r.failure(d(!1,e),e)}),r},m=function(t,n,o,a){var f=new FormData,l=e.demoMode?"GET":"POST",c=e.endpointStore.get(a),h=r(a),p=i(a);return t[e.uuidName]=s(a),t[e.filenameParam]=h,u&&(t[e.totalFileSizeName]=p),e.paramsInBody||(u||(t[e.inputName]=h),c=qq.obj2url(t,c)),n.open(l,c,!0),e.cors.expected&&e.cors.sendCredentials&&(n.withCredentials=!0),u?(e.paramsInBody&&qq.obj2FormData(t,f),f.append(e.inputName,o),f):o},g=function(t,r){var i=e.customHeaders.get(t),s=n.getFile(t);r.setRequestHeader("Accept","application/json"),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Cache-Control","no-cache"),u||(r.setRequestHeader("Content-Type","application/octet-stream"),r.setRequestHeader("X-Mime-Type",s.type)),qq.each(i,function(e,t){r.setRequestHeader(e,t)})};qq.extend(this,{uploadChunk:function(t,r,s){var o=n._getChunkData(t,r),u=n._createXhr(t,r),f=i(t),c,h,p;return c=l(t,u),n._registerProgressHandler(t,r,o.size),p=e.paramsStore.get(t),a(t,p,o),s&&(p[e.resume.paramNames.resuming]=!0),h=m(p,u,o.blob,t),g(t,u),u.send(h),c},uploadFile:function(t){var r=n.getFile(t),i,s,o,u;return s=n._createXhr(t),n._registerProgressHandler(t),i=l(t,s),o=e.paramsStore.get(t),u=m(o,s,r,t),g(t,s),s.send(u),i}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},e),proxy:qq.extend({getEndpoint:e.endpointStore.get},t)})),qq.override(this,function(t){return{finalizeChunks:function(n){return e.chunking.success.endpoint?v(n):t.finalizeChunks(n,qq.bind(d,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var t,n="POST",r={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(e,t){}},i={},s={get:function(e){return r.endpoint}};qq.extend(r,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:[n],method:n,successfulResponseCodes:function(){var e={};return e[n]=[200,201,202],e}(),endpointStore:s,allowXRequestedWithAndCacheControl:!1,cors:r.cors,log:r.log,onComplete:function(e,t,n){var r=i[e];delete i[e],n?r.failure(t):r.success(t)}})),qq.extend(this,{complete:function(e,n,s,o){var u=new qq.Promise;return r.log("Submitting All Chunks Done request for "+e),i[e]=u,t.initTransport(e).withParams(s).withHeaders(o).send(n),u}})},qq.PasteSupport=function(e){"use strict";function r(e){return e.type&&e.type.indexOf("image/")===0}function i(){n=qq(t.targetElement).attach("paste",function(e){var n=e.clipboardData;n&&qq.each(n.items,function(e,n){if(r(n)){var i=n.getAsFile();t.callbacks.pasteReceived(i)}})})}function s(){n&&n()}var t,n;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},qq.extend(t,e),i(),qq.extend(this,{reset:function(){s()}})},qq.DragAndDrop=function(e){"use strict";function u(e,n){var r=Array.prototype.slice.call(e);t.callbacks.dropLog("Grabbed "+e.length+" dropped files."),n.dropDisabled(!1),t.callbacks.processingDroppedFilesComplete(r,n.getElement())}function a(e){var n=new qq.Promise;return e.isFile?e.file(function(t){var r=e.name,i=e.fullPath,o=i.indexOf(r);i=i.substr(0,o),i.charAt(0)==="/"&&(i=i.substr(1)),t.qqPath=i,s.push(t),n.success()},function(r){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+r.code+".","error"),n.failure()}):e.isDirectory&&f(e).then(function(t){var r=t.length;qq.each(t,function(e,t){a(t).done(function(){r-=1,r===0&&n.success()})}),t.length||n.success()},function(i){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+i.code+".","error"),n.failure()}),n}function f(e,t,n,r){var i=r||new qq.Promise,s=t||e.createReader();return s.readEntries(function(r){var o=n?n.concat(r):r;r.length?setTimeout(function(){f(e,s,o,i)},0):i.success(o)},i.failure),i}function l(e,n){var r=[],i=new qq.Promise;return t.callbacks.processingDroppedFiles(),n.dropDisabled(!0),e.files.length>1&&!t.allowMultipleItems?(t.callbacks.processingDroppedFilesComplete([]),t.callbacks.dropError("tooManyFilesError",""),n.dropDisabled(!1),i.failure()):(s=[],qq.isFolderDropSupported(e)?qq.each(e.items,function(e,t){var n=t.webkitGetAsEntry();n&&(n.isFile?s.push(t.getAsFile()):r.push(a(n).done(function(){r.pop(),r.length===0&&i.success()})))}):s=e.files,r.length===0&&i.success()),i}function c(e){var a=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:n,element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive),n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive)},onDrop:function(e){l(e.dataTransfer,a).then(function(){u(s,a)},function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return o.addDisposer(function(){a.dispose()}),qq(e).hasAttribute(r)&&qq(e).hide(),i.push(a),a}function h(e){var t;return qq.each(e.dataTransfer.types,function(e,n){if(n==="Files")return t=!0,!1}),t}function p(e){return qq.firefox()?!e.relatedTarget:qq.safari()?e.x<0||e.y<0:e.x===0&&e.y===0}function d(){var e=t.dropZoneElements,i=function(){setTimeout(function(){qq.each(e,function(e,n){qq(n).hasAttribute(r)&&qq(n).hide(),qq(n).removeClass(t.classes.dropActive)})},10)};qq.each(e,function(t,n){var i=c(n);e.length&&qq.supportedFeatures.fileDrop&&o.attach(document,"dragenter",function(t){!i.dropDisabled()&&h(t)&&qq.each(e,function(e,t){t instanceof HTMLElement&&qq(t).hasAttribute(r)&&qq(t).css({display:"block"})})})}),o.attach(document,"dragleave",function(e){p(e)&&i()}),o.attach(qq(document).children()[0],"mouseenter",function(e){i()}),o.attach(document,"drop",function(e){e.preventDefault(),i()}),o.attach(document,n,i)}var t,n="qq-hidezones",r="qq-hide-dropzone",i=[],s=[],o=new qq.DisposeSupport;t={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(t,e,!0),d(),qq.extend(this,{setupExtraDropzone:function(e){t.dropZoneElements.push(e),c(e)},removeDropzone:function(e){var n,r=t.dropZoneElements;for(n in r)if(r[n]===e)return r.splice(n,1)},dispose:function(){o.dispose(),qq.each(i,function(e,t){t.dispose()})}})},qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}},qq.UploadDropZone=function(e){"use strict";function o(){return qq.safari()||qq.firefox()&&qq.windows()}function u(e){s||(o?t.attach(document,"dragover",function(e){e.preventDefault()}):t.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),s=!0)}function a(e){if(!qq.supportedFeatures.fileDrop)return!1;var t,n=e.dataTransfer,r=qq.safari();return t=qq.ie()&&qq.supportedFeatures.fileDrop?!0:n.effectAllowed!=="none",n&&t&&(n.files||!r&&n.types.contains&&n.types.contains("Files"))}function f(e){return e!==undefined&&(i=e),i}function l(){function t(){e=document.createEvent("Event"),e.initEvent(n.HIDE_ZONES_EVENT_NAME,!0,!0)}var e;if(window.CustomEvent)try{e=new CustomEvent(n.HIDE_ZONES_EVENT_NAME)}catch(r){t()}else t();document.dispatchEvent(e)}function c(){t.attach(r,"dragover",function(e){if(!a(e))return;var t=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;t==="move"||t==="linkMove"?e.dataTransfer.dropEffect="move":e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault()}),t.attach(r,"dragenter",function(e){if(!f()){if(!a(e))return;n.onEnter(e)}}),t.attach(r,"dragleave",function(e){if(!a(e))return;n.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);if(qq(this).contains(t))return;n.onLeaveNotDescendants(e)}),t.attach(r,"drop",function(e){if(!f()){if(!a(e))return;e.preventDefault(),e.stopPropagation(),n.onDrop(e),l()}})}var t=new qq.DisposeSupport,n,r,i,s;n={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(n,e),r=n.element,u(),c(),qq.extend(this,{dropDisabled:function(e){return f(e)},dispose:function(){t.dispose()},getElement:function(){return r}})},qq.DeleteFileAjaxRequester=function(e){"use strict";function r(){return n.method.toUpperCase()==="POST"?{_method:"DELETE"}:{}}var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:r(),maxConnections:n.maxConnections,customHeaders:function(e){return n.customHeaders.get(e)},demoMode:n.demoMode,log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors})),qq.extend(this,{sendDelete:function(e,r,i){var s=i||{};n.log("Submitting delete file request for "+e),n.method==="DELETE"?t.initTransport(e).withPath(r).withParams(s).send():(s[n.uuidParamName]=r,t.initTransport(e).withParams(s).send())}})},function(){function e(e){var t=e.naturalWidth,n=e.naturalHeight,r=document.createElement("canvas"),i;return t*n>1048576?(r.width=r.height=1,i=r.getContext("2d"),i.drawImage(e,-t+1,0),i.getImageData(0,0,1,1).data[3]===0):!1}function t(e,t,n){var r=document.createElement("canvas"),i=0,s=n,o=n,u,a,f,l;r.width=1,r.height=n,u=r.getContext("2d"),u.drawImage(e,0,0),a=u.getImageData(0,0,1,n).data;while(o>i)f=a[(o-1)*4+3],f===0?s=o:i=o,o=s+i>>1;return l=o/n,l===0?1:l}function n(e,t,n){var r=document.createElement("canvas"),s=t.mime||"image/jpeg";return i(e,r,t,n),r.toDataURL(s,t.quality||.8)}function r(e){var t=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(e.origHeight*e.origWidth>t)return{newHeight:Math.round(Math.sqrt(t*(e.origHeight/e.origWidth))),newWidth:Math.round(Math.sqrt(t*(e.origWidth/e.origHeight)))}}function i(n,i,o,u){var a=n.naturalWidth,f=n.naturalHeight,l=o.width,c=o.height,h=i.getContext("2d"),p;h.save(),qq.supportedFeatures.unlimitedScaledImageSize||(p=r({origWidth:l,origHeight:c}),p&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",l,c,p.newWidth,p.newHeight),"warn"),l=p.newWidth,c=p.newHeight)),s(i,l,c,o.orientation),qq.ios()?function(){e(n)&&(a/=2,f/=2);var r=1024,i=document.createElement("canvas"),s=u?t(n,a,f):1,o=Math.ceil(r*l/a),p=Math.ceil(r*c/f/s),d=0,v=0,m,g,y;i.width=i.height=r,m=i.getContext("2d");while(d<f){g=0,y=0;while(g<a)m.clearRect(0,0,r,r),m.drawImage(n,-g,-d),h.drawImage(i,0,0,r,r,y,v,o,p),g+=r,y+=o;d+=r,v+=p}h.restore(),i=m=null}():h.drawImage(n,0,0,l,c),i.qqImageRendered&&i.qqImageRendered()}function s(e,t,n,r){switch(r){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var i=e.getContext("2d");switch(r){case 2:i.translate(t,0),i.scale(-1,1);break;case 3:i.translate(t,n),i.rotate(Math.PI);break;case 4:i.translate(0,n),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI),i.translate(t,-n),i.scale(-1,1);break;case 8:i.rotate(-0.5*Math.PI),i.translate(-t,0);break;default:}}function o(e,t){var n=this;window.Blob&&e instanceof Blob&&function(){var t=new Image,r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!r)throw Error("No createObjectURL function found to create blob url");t.src=r.createObjectURL(e),n.blob=e,e=t}(),!e.naturalWidth&&!e.naturalHeight&&(e.onload=function(){var e=n.imageLoadListeners;e&&(n.imageLoadListeners=null,setTimeout(function(){for(var t=0,n=e.length;t<n;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]),this.srcImage=e}o.prototype.render=function(e,t){t=t||{};var r=this,s=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,u=t.width,a=t.height,f=t.maxWidth,l=t.maxHeight,c=!this.blob||this.blob.type==="image/jpeg",h=e.tagName.toLowerCase(),p;if(this.imageLoadListeners){this.imageLoadListeners.push(function(){r.render(e,t)});return}u&&!a?a=o*u/s<<0:a&&!u?u=s*a/o<<0:(u=s,a=o),f&&u>f&&(u=f,a=o*u/s<<0),l&&a>l&&(a=l,u=s*a/o<<0),p={width:u,height:a},qq.each(t,function(e,t){p[e]=t}),h==="img"?function(){var t=e.src;e.src=n(r.srcImage,p,c),t===e.src&&e.onload()}():h==="canvas"&&i(this.srcImage,e,p,c),typeof this.onrender=="function"&&this.onrender(e)},qq.MegaPixImage=o}(),qq.ImageGenerator=function(e){"use strict";function t(e){return e.tagName.toLowerCase()==="img"}function n(e){return e.tagName.toLowerCase()==="canvas"}function r(){return(new Image).crossOrigin!==undefined}function i(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function s(e){var t=e.split("/"),n=t[t.length-1],r=qq.getExtension(n);r=r&&r.toLowerCase();switch(r){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function o(e){var t=document.createElement("a"),n,r,i;return t.href=e,n=t.protocol,i=t.port,r=t.hostname,n.toLowerCase()!==window.location.protocol.toLowerCase()?!0:r.toLowerCase()!==window.location.hostname.toLowerCase()?!0:i!==window.location.port&&!qq.ie()?!0:!1}function u(t,n){t.onload=function(){t.onload=null,t.onerror=null,n.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),n.failure(t,"Problem drawing thumbnail!")}}function a(e,t){e.qqImageRendered=function(){t.success(e)}}function f(r,i){var s=t(r)||n(r);return t(r)?u(r,i):n(r)?a(r,i):(i.failure(r),e(qq.format("Element container of type {} is not supported!",r.tagName),"error")),s}function l(t,n,r){var i=new qq.Promise,s=new qq.Identify(t,e),o=r.maxSize,u=r.orient==null?!0:r.orient,a=function(){n.onerror=null,n.onload=null,e("Could not render preview, file may be too large!","error"),i.failure(n,"Browser cannot render image!")};return s.isPreviewable().then(function(r){var s={parse:function(){return(new qq.Promise).success()}},l=u?new qq.Exif(t,e):s,c=new qq.MegaPixImage(t,a);f(n,i)&&l.parse().then(function(e){var t=e&&e.Orientation;c.render(n,{maxWidth:o,maxHeight:o,orientation:t,mime:r})},function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t)),c.render(n,{maxWidth:o,maxHeight:o,mime:r})})},function(){e("Not previewable"),i.failure(n,"Not previewable")}),i}function c(e,t,n,r){var i=new Image,u=new qq.Promise;f(i,u),o(e)&&(i.crossOrigin="anonymous"),i.src=e,u.then(function(){f(t,n);var u=new qq.MegaPixImage(i);u.render(t,{maxWidth:r,maxHeight:r,mime:s(e)})},n.failure)}function h(e,t,n,r){f(t,n),qq(t).css({maxWidth:r+"px",maxHeight:r+"px"}),t.src=e}function p(e,s,u){var a=new qq.Promise,l=u.scale,p=l?u.maxSize:null;return l&&t(s)?i()?o(e)&&!r()?h(e,s,a,p):c(e,s,a,p):h(e,s,a,p):n(s)?c(e,s,a,p):f(s,a)&&(s.src=e),a}qq.extend(this,{generate:function(t,n,r){return qq.isString(t)?(e("Attempting to update thumbnail based on server response."),p(t,n,r||{})):(e("Attempting to draw client-side image preview."),l(t,n,r||{}))}})},qq.Exif=function(e,t){"use strict";function i(e){var t=0,n=0;while(e.length>0)t+=parseInt(e.substring(0,2),16)*Math.pow(2,n),e=e.substring(2,e.length),n+=8;return t}function s(t,n){var r=t,i=n;return r===undefined&&(r=2,i=new qq.Promise),qq.readBlobToHex(e,r,4).then(function(e){var t=/^ffe([0-9])/.exec(e),n;t?t[1]!=="1"?(n=parseInt(e.slice(4,8),16),s(r+n+2,i)):i.success(r):i.failure("No EXIF header to be found!")}),i}function o(){var t=new qq.Promise;return qq.readBlobToHex(e,0,6).then(function(e){e.indexOf("ffd8")!==0?t.failure("Not a valid JPEG!"):s().then(function(e){t.success(e)},function(e){t.failure(e)})}),t}function u(t){var n=new qq.Promise;return qq.readBlobToHex(e,t+10,2).then(function(e){n.success(e==="4949")}),n}function a(t,n){var r=new qq.Promise;return qq.readBlobToHex(e,t+18,2).then(function(e){if(n)return r.success(i(e));r.success(parseInt(e,16))}),r}function f(t,n){var r=t+20,i=n*12;return qq.readBlobToHex(e,r,i)}function l(e){var t=[],n=0;while(n+24<=e.length)t.push(e.slice(n,n+24)),n+=24;return t}function c(e,t){var s=16,o=qq.extend([],n),u={};return qq.each(t,function(t,n){var a=n.slice(0,4),f=e?i(a):parseInt(a,16),l=o.indexOf(f),c,h,p;l>=0&&(h=r[f].name,p=r[f].bytes,c=n.slice(s,s+p*2),u[h]=e?i(c):parseInt(c,16),o.splice(l,1));if(o.length===0)return!1}),u}var n=[274],r={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var n=new qq.Promise,r=function(e){t(qq.format("EXIF header parse failed: '{}' ",e)),n.failure(e)};return o().then(function(i){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===undefined?"blob":e.name)),u(i).then(function(e){t(qq.format("EXIF Byte order is {} endian",e?"little":"big")),a(i,e).then(function(s){t(qq.format("Found {} APP1 directory entries",s)),f(i,s).then(function(r){var i=l(r),s=c(e,i);t("Successfully parsed some EXIF tags"),n.success(s)},r)},r)},r)},r),n}})},qq.Identify=function(e,t){"use strict";function n(e,t){var n=!1,r=[].concat(e);return qq.each(r,function(e,r){if(t.indexOf(r)===0)return n=!0,!1}),n}qq.extend(this,{isPreviewable:function(){var r=this,i=new qq.Promise,s=!1,o=e.name===undefined?"blob":e.name;return t(qq.format("Attempting to determine if {} can be rendered in this browser",o)),t("First pass: check type attribute of blob object."),this.isPreviewableSync()?(t("Second pass: check for magic bytes in file header."),qq.readBlobToHex(e,0,4).then(function(e){qq.each(r.PREVIEWABLE_MIME_TYPES,function(t,r){if(n(r,e)){if(t!=="image/tiff"||qq.supportedFeatures.tiffPreviews)s=!0,i.success(t);return!1}}),t(qq.format("'{}' is {} able to be rendered in this browser",o,s?"":"NOT")),s||i.failure()},function(){t("Error reading file w/ name '"+o+"'.  Not able to be rendered in this browser."),i.failure()})):i.failure(),i},isPreviewableSync:function(){var n=e.type,r=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),n)>=0,i=!1,s=e.name===undefined?"blob":e.name;return r&&(n==="image/tiff"?i=qq.supportedFeatures.tiffPreviews:i=!0),!i&&t(s+" is not previewable in this browser per the blob's type attr"),i}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(e,t){"use strict";function n(e){var t=!1;return qq.each(e,function(e,n){if(n>0)return t=!0,!1}),t}function r(){var n=new qq.Promise;return(new qq.Identify(e,t)).isPreviewable().then(function(){var r=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;i?(r.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error"),n.failure()},r.onload=function(){n.success({width:this.width,height:this.height})},r.src=i.createObjectURL(e)):(t("No createObjectURL function available to generate image URL!","error"),n.failure())},n.failure),n}function i(e,t){var n;return qq.each(e,function(e,r){if(r>0){var i=/(max|min)(Width|Height)/.exec(e),s=i[2].charAt(0).toLowerCase()+i[2].slice(1),o=t[s];switch(i[1]){case"min":if(o<r)return n=e,!1;break;case"max":if(o>r)return n=e,!1}}}),n}this.validate=function(e){var s=new qq.Promise;return t("Attempting to validate image."),n(e)?r().then(function(t){var n=i(e,t);n?s.failure(n):s.success()},s.success):s.success(),s}},qq.Session=function(e){"use strict";function n(e){if(qq.isArray(e))return!0;t.log("Session response is not an array.","error")}function r(e,r,i,s){var o=!1;r=r&&n(e),r&&qq.each(e,function(e,n){if(n.uuid==null)o=!0,t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(n.name==null)o=!0,t.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return t.addFileRecord(n),!0}catch(r){o=!0,t.log(r.message,"error")}return!1}),s[r&&!o?"success":"failure"](e,i)}var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};qq.extend(t,e,!0),this.refresh=function(){var e=new qq.Promise,n=function(t,n,i){r(t,n,i,e)},i=qq.extend({},t),s=new qq.SessionAjaxRequester(qq.extend(i,{onComplete:n}));return s.queryServer(),e}},qq.SessionAjaxRequester=function(e){"use strict";function r(e,t,r){var i=null;if(t.responseText!=null)try{i=qq.parseJson(t.responseText)}catch(s){n.log("Problem parsing session response: "+s.message,"error"),r=!0}n.onComplete(i,!r,t)}var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(n,e),t=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:r,cors:n.cors})),qq.extend(this,{queryServer:function(){var e=qq.extend({},n.params);n.log("Session query request."),t.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},qq.FormSupport=function(e,t,n){"use strict";function u(e){e.getAttribute("action")&&(r.newEndpoint=e.getAttribute("action"))}function a(e,t){if(!e.checkValidity||!!e.checkValidity())return!0;n("Form did not pass validation checks - will not upload.","error"),t()}function f(e){var n=e.submit;qq(e).attach("submit",function(r){r=r||window.event,r.preventDefault?r.preventDefault():r.returnValue=!1,a(e,n)&&t()}),e.submit=function(){a(e,n)&&t()}}function l(e){return e&&(qq.isString(e)&&(e=document.getElementById(e)),e&&(n("Attaching to form element."),u(e),i&&f(e))),e}var r=this,i=e.interceptSubmit,s=e.element,o=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:o,attachedToForm:!1,getFormInputsAsObject:function(){return s==null?null:r._form2Obj(s)}}),s=l(s),this.attachedToForm=!!s},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){var t=["button","image","reset","submit"];return qq.indexOf(t,e.toLowerCase())<0},r=function(e){return qq.indexOf(["checkbox","radio"],e.toLowerCase())>=0},i=function(e){return r(e.type)&&!e.checked?!0:e.disabled&&e.type.toLowerCase()!=="hidden"},s=function(e){var t=null;return qq.each(qq(e).children(),function(e,n){if(n.tagName.toLowerCase()==="option"&&n.selected)return t=n.value,!1}),t};return qq.each(e.elements,function(e,r){if((qq.isInput(r,!0)||r.tagName.toLowerCase()==="textarea")&&n(r.type)&&!i(r))t[r.name]=r.value;else if(r.tagName.toLowerCase()==="select"&&!i(r)){var o=s(r);o!==null&&(t[r.name]=o)}}),t}}),qq.Scaler=function(e,t){"use strict";var n=this,r=e.sendOriginal,i=e.orient,s=e.defaultType,o=e.defaultQuality/100,u=e.failureText,a=e.includeExif,f=this._getSortedSizes(e.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&f.length>0,getFileRecords:function(e,n,l){var c=this,h=[],p=l.blob?l.blob:l,d=new qq.Identify(p,t);return d.isPreviewableSync()?(qq.each(f,function(e,r){var f=c._determineOutputType({defaultType:s,requestedType:r.type,refType:p.type});h.push({uuid:qq.getUniqueId(),name:c._getName(n,{name:r.name,type:f,refType:p.type}),blob:new qq.BlobProxy(p,qq.bind(c._generateScaledImage,c,{maxSize:r.maxSize,orient:i,type:f,quality:o,failedText:u,includeExif:a,log:t}))})}),r&&h.push({uuid:e,name:n,blob:p})):h.push({uuid:e,name:n,blob:p}),h},handleNewFile:function(e,t,n,r,i,s,o,u){var a=this,f=e.qqButtonId||e.blob&&e.blob.qqButtonId,l=[],c=null,h=u.addFileToHandler,p=u.uploadData,d=u.paramsStore,v=qq.getUniqueId();qq.each(a.getFileRecords(n,t,e),function(t,n){var o=e,u=r,a;n.blob instanceof qq.BlobProxy&&(o=n.blob,u=-1),a=p.addFile({uuid:n.uuid,name:n.name,size:u,batchId:s,proxyGroupId:v}),n.blob instanceof qq.BlobProxy?l.push(a):c=a,h(a,o),i.push({id:a,file:o})}),c!==null&&(qq.each(l,function(e,t){var n={qqparentuuid:p.retrieve({id:c}).uuid,qqparentsize:p.retrieve({id:c}).size};n[o]=p.retrieve({id:t}).uuid,p.setParentId(t,c),d.addReadOnly(t,n)}),l.length&&function(){var e={};e[o]=p.retrieve({id:c}).uuid,d.addReadOnly(c,e)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(e,t,n){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var r=new qq.Promise,i=n.log,s=n.getFile(e),o=n.uploadData.retrieve({id:e}),u=o&&o.name,a=o&&o.uuid,f={sendOriginal:!1,orient:t.orient,defaultType:t.type||null,defaultQuality:t.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:t.maxSize}]},l=new qq.Scaler(f,i);return!qq.Scaler||!qq.supportedFeatures.imagePreviews||!s?(r.failure(),i("Could not generate requested scaled image for "+e+".  "+"Scaling is either not possible in this browser, or the file could not be located.","error")):qq.bind(function(){var t=l.getFileRecords(a,u,s)[0];t&&t.blob instanceof qq.BlobProxy?t.blob.create().then(r.success,r.failure):(i(e+" is not a scalable image!","error"),r.failure())},this)(),r},_determineOutputType:function(e){"use strict";var t=e.requestedType,n=e.defaultType,r=e.refType;return!n&&!t?r!=="image/jpeg"?"image/png":r:t?qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),t)>=0?t==="image/tiff"?qq.supportedFeatures.tiffPreviews?t:n:t:n:n},_getName:function(e,t){"use strict";var n=e.lastIndexOf("."),r=t.type||"image/png",i=t.refType,s="",o=qq.getExtension(e),u="";return t.name&&t.name.trim().length&&(u=" ("+t.name+")"),n>=0?(s=e.substr(0,n),i!==r&&(o=r.split("/")[1]),s+=u+"."+o):s=e+u,s},_getSortedSizes:function(e){"use strict";return e=qq.extend([],e),e.sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,t){"use strict";var n=this,r=e.log,i=e.maxSize,s=e.orient,o=e.type,u=e.quality,a=e.failedText,f=e.includeExif&&t.type==="image/jpeg"&&o==="image/jpeg",l=new qq.Promise,c=new qq.ImageGenerator(r),h=document.createElement("canvas");return r("Attempting to generate scaled version for "+t.name),c.generate(t,h,{maxSize:i,orient:s}).then(function(){var e=h.toDataURL(o,u),i=function(){r("Success generating scaled version for "+t.name);var n=qq.dataUriToBlob(e);l.success(n)};f?n._insertExifHeader(t,e,r).then(function(t){e=t,i()},function(){r("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),i()}):i()},function(){r("Failed attempt to generate scaled version for "+t.name,"error"),l.failure(a)}),l},_insertExifHeader:function(e,t,n){"use strict";var r=new FileReader,i=new qq.Promise,s="";return r.onload=function(){s=r.result,i.success(ExifRestorer.restore(s,t))},r.onerror=function(){n("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),i.failure()},r.readAsDataURL(e),i},_dataUriToBlob:function(e){"use strict";var t,n,r,i;return e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=decodeURI(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r),qq.each(t,function(e,t){i[e]=t.charCodeAt(0)}),this._createBlob(r,n)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=n&&new n;return r?(r.append(e),r.getBlob(t)):new Blob([e],{type:t})}});var ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(e){var t="",n,r,i="",s,o,u,a="",f=0;do n=e[f++],r=e[f++],i=e[f++],s=n>>2,o=(n&3)<<4|r>>4,u=(r&15)<<2|i>>6,a=i&63,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t=t+this.KEY_STR.charAt(s)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(u)+this.KEY_STR.charAt(a),n=r=i="",s=o=u=a="";while(f<e.length);return t},e.restore=function(e,t){var n="data:image/jpeg;base64,";if(!e.match(n))return t;var r=this.decode64(e.replace(n,"")),i=this.slice2Segments(r),s=this.exifManipulation(t,i);return n+this.encode64(s)},e.exifManipulation=function(e,t){var n=this.getExifArray(t),r=this.insertExif(e,n),i=new Uint8Array(r);return i},e.getExifArray=function(e){var t;for(var n=0;n<e.length;n++){t=e[n];if(t[0]==255&t[1]==225)return t}return[]},e.insertExif=function(e,t){var n=e.replace("data:image/jpeg;base64,",""),r=this.decode64(n),i=r.indexOf(255,3),s=r.slice(0,i),o=r.slice(i),u=s;return u=u.concat(t),u=u.concat(o),u},e.slice2Segments=function(e){var t=0,n=[];for(;;){if(e[t]==255&e[t+1]==218)break;if(e[t]==255&e[t+1]==216)t+=2;else{var r=e[t+2]*256+e[t+3],i=t+r+2,s=e.slice(t,i);n.push(s),t=i}if(t>e.length)break}return n},e.decode64=function(e){var t="",n,r,i="",s,o,u,a="",f=0,l=[],c=/[^A-Za-z0-9\+\/\=]/g;if(c.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do s=this.KEY_STR.indexOf(e.charAt(f++)),o=this.KEY_STR.indexOf(e.charAt(f++)),u=this.KEY_STR.indexOf(e.charAt(f++)),a=this.KEY_STR.indexOf(e.charAt(f++)),n=s<<2|o>>4,r=(o&15)<<4|u>>2,i=(u&3)<<6|a,l.push(n),u!=64&&l.push(r),a!=64&&l.push(i),n=r=i="",s=o=u=a="";while(f<e.length);return l},e}();qq.TotalProgress=function(e,t){"use strict";var n={},r=0,i=0,s=-1,o=-1,u=function(t,n){(t!==s||n!==o)&&e(t,n),s=t,o=n},a=function(e,t){var n=!0;return qq.each(e,function(e,r){if(qq.indexOf(t,r)>=0)return n=!1,!1}),n},f=function(e){h(e,-1,-1),delete n[e]},l=function(e,t,n){if(t.length===0||a(t,n))u(i,i),this.reset()},c=function(e){var r=t(e);r>0&&(h(e,0,r),n[e]={loaded:0,total:r})},h=function(e,t,s){var o=n[e]?n[e].loaded:0,a=n[e]?n[e].total:0;t===-1&&s===-1?(r-=o,i-=a):(t&&(r+=t-o),s&&(i+=s-a)),u(r,i)};qq.extend(this,{onAllComplete:l,onStatusChange:function(e,t,n){n===qq.status.CANCELED||n===qq.status.REJECTED?f(e):n===qq.status.SUBMITTING&&c(e)},onIndividualProgress:function(e,t,r){h(e,t,r),n[e]={loaded:t,total:r}},onNewSize:function(e){c(e)},reset:function(){n={},r=0,i=0}})},qq.UiEventHandler=function(e,t){"use strict";function i(e){n.attach(e,r.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;r.onHandled(t,e)})}var n=new qq.DisposeSupport,r={eventType:"click",attachTo:null,onHandled:function(e,t){}};qq.extend(this,{addHandler:function(e){i(e)},dispose:function(){n.dispose()}}),qq.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return n}}),qq.extend(r,e),r.attachTo&&i(r.attachTo)},qq.FileButtonsClickHandler=function(e){"use strict";function i(e,t){qq.each(r,function(r,i){var s=r.charAt(0).toUpperCase()+r.slice(1),o;if(n.templating["is"+s](e))return o=n.templating.getFileId(e),qq.preventDefault(t),n.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",n.onGetName(o),o)),i(o),!1})}var t={},n={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},r={cancel:function(e){n.onCancel(e)},retry:function(e){n.onRetry(e)},deleteButton:function(e){n.onDeleteFile(e)},pause:function(e){n.onPause(e)},continueButton:function(e){n.onContinue(e)}};qq.extend(n,e),n.eventType="click",n.onHandled=i,n.attachTo=n.templating.getFileList(),qq
.extend(this,new qq.UiEventHandler(n,t))},qq.FilenameClickHandler=function(e){"use strict";function r(e,r){if(n.templating.isFileName(e)||n.templating.isEditIcon(e)){var i=n.templating.getFileId(e),s=n.onGetUploadStatus(i);s===qq.status.SUBMITTED&&(n.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(i),i)),qq.preventDefault(r),t.handleFilenameEdit(i,e,!0))}}var t={},n={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};qq.extend(n,e),n.eventType="click",n.onHandled=r,qq.extend(this,new qq.FilenameEditHandler(n,t))},qq.FilenameInputFocusInHandler=function(e,t){"use strict";function r(e,r){if(n.templating.isEditInput(e)){var i=n.templating.getFileId(e),s=n.onGetUploadStatus(i);s===qq.status.SUBMITTED&&(n.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(i),i)),t.handleFilenameEdit(i,e))}}var n={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};t||(t={}),n.eventType="focusin",n.onHandled=r,qq.extend(n,e),qq.extend(this,new qq.FilenameEditHandler(n,t))},qq.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus",e.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))},qq.FilenameEditHandler=function(e,t){"use strict";function r(e){var t=n.onGetName(e),r=t.lastIndexOf(".");return r>0&&(t=t.substr(0,r)),t}function i(e){var t=n.onGetName(e);return qq.getExtension(t)}function s(e,t){var r=e.value,s;r!==undefined&&qq.trimStr(r).length>0&&(s=i(t),s!==undefined&&(r=r+"."+s),n.onSetName(t,r)),n.onEditingStatusChange(t,!1)}function o(e,n){t.getDisposeSupport().attach(e,"blur",function(){s(e,n)})}function u(e,n){t.getDisposeSupport().attach(e,"keyup",function(t){var r=t.keyCode||t.which;r===13&&s(e,n)})}var n={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};qq.extend(n,e),n.attachTo=n.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(n,t)),qq.extend(t,{handleFilenameEdit:function(e,t,i){var s=n.templating.getEditInput(e);n.onEditingStatusChange(e,!0),s.value=r(e),i&&s.focus(),o(s,e),u(s,e)}})};